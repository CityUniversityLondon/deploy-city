CITY.profiles=function(){var s,e,i,l,a=$("#content"),n=$(".subfamily-choice"),t=$("#fb-profiles-wrapper #results-wrapper ol"),r=$("#fb-profiles-wrapper").attr("data-family"),p=function(a){t.addClass("js-load-hide").append($('<i class="fa fa-refresh fa-spin loading-fa-icon"></i>')),e=$.param.fragment(),i=$.deparam(e),""===e&&void 0===a?t.hide().fadeIn(800).removeClass("js-load-hide").children(".loading-fa-icon").remove():$.ajax({url:"/api/search.html?"+e+"&collection=profiles&form=profiles&meta_B_orsand="+r+"&simpleResults=true&sort=metaK&bustCache="+Math.random(),success:function(a){t.empty().append(a).hide().fadeIn(800).removeClass("js-load-hide"),s.find("li").remove(),$.each(i,function(a,e){"meta_C_orsand"===a?(l=e.replace("[","").replace(/"/g,"").replace("]","").split(","),$.each(l,function(a,e){n.find('li a[class="'+e.replace(/ /g,"-")+'"]').addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden">remove filter</span></span>'),t.find(".subfamily a[data-filter=\"meta_C_orsand=['"+e+"']\"]").addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden" remove filter</span></span>')})):(s.append("<li data-filter="+a+'><a href="#">'+e.replace(/"/g,"")+'<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden">remove filter</span></span></a></li>'),t.find('.tag-list a[data-filter="'+a+"="+e+'"]').addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden" remove filter</span></span>'))})}})};$("#results-wrapper").before('<ul class="display-filters"></ul>'),s=$(".display-filters"),a.on("click",".tag-list a, .subfamily-choice a",function(a){var e,s,i,l=$(this),t=$.deparam.fragment(),r=[];l.parents("ul:eq(0)").hasClass("tag-list")?((s=l.attr("data-filter")).split("=")[0],s.split("=")[1],l.hasClass("active")?(l.parent("li").hasClass("subfamily")?(i=l.attr("data-family-filter"),(r=t.meta_C_orsand.replace("[","").replace("]","").split(",")).splice($.inArray('"'+i+'"',r),1).join(","),e="meta_C_orsand=["+r+"]",$.bbq.pushState(e),n.find("a."+i).removeClass("active").find(".remove-filter").remove()):$.bbq.removeState(s.split("=")[0]),l.removeClass("active").find(".remove-filter").remove()):$.bbq.pushState(s)):(i=l.attr("data-family-filter"),e=l.hasClass("active")?((r=t.meta_C_orsand.replace("[","").replace("]","").split(",")).splice($.inArray('"'+i+'"',r),1).join(","),l.removeClass("active").find(".remove-filter").remove(),0===r.length?"meta_C_orsand=":"meta_C_orsand=["+r+"]"):(void 0===t.meta_C_orsand||""===t.meta_C_orsand.replace("[","").replace("]","").split(",")[0]?r='"'+i+'"':((r=t.meta_C_orsand.replace("[","").replace("]","").split(",")).push('"'+i+'"'),r.join(",")),"meta_C_orsand=["+r+"]"),$.bbq.pushState(e)),a.preventDefault()}),p(),a.on("click",".display-filters a",function(a){$.bbq.removeState($(this).parent("li").attr("data-filter").split("=")[0]),a.preventDefault()}),$(window).on("hashchange",function(a){p(a)})}(CITY.debug);