CITY.indexPage=function(N,B){return{init:function(){var e,n=B("html, body"),a=B(".index-form"),A=B("#index-query",a),F=B("#results-wrapper"),I=F.find("#results"),M=B("#current-query"),l=B("#active-filters"),r=B("#filtered-by"),t=B("#reload"),P=B("<span/>",{class:"loader",id:"course-loader",text:"loading..."}),Y=null,_=B("<li/>",{class:"no-results hidden",html:'<p>Sorry, your search has resulted in 0 matches. Try selecting fewer filters or <a href="" id="reload">Start Again<span>Refresh Page</span></a>'}),E=a.attr("id").replace("-form",""),i=a.find("#collection").val(),G=null;function s(){a.find(":radio:checked").add(":checkbox:checked",a).not("#all-dates").not(".hidden").each(function(){var t=B(this),e=t.parent().text();B('<li class="active-filter"></li>').html('<a href="#" title="remove this filter">'+e+'<span class="close">remove</span></a>').click(function(e){return t.attr("checked",!1),a.submit(),!1}).appendTo(l)})}function d(e,t,a){var i;return B.param(e),A.val()||(i=e.length,e[0]={name:"",value:""},e[i]={name:"landing",value:"true"}),F.addClass("loading").prepend(P),l.empty("slow"),M.addClass("loading"),n.animate({scrollTop:0},"slow"),s(),1<=l.children().length?r.show():r.hide(),!0}function c(e,t,a,i){if(F.removeClass("loading"),I.empty(),P.remove(),A.attr("name","query"),B(e).find("total_matching").each(function(){Y=B(this).text()}),G=0!==A.val().length?A.val():"All "+E,0===B(e).find("result").length)return M.html("No results found for: <strong>"+G+"</strong>"),_.addClass("visible").removeClass("hidden"),void I.append(_);var n,l,r,s,d,c,o,f,u,m,h,p,v,x,g,y,b,w,C,k,T,S,j,q;"events"===E||"concerts"===E||"careers"===E?(m=B(e),q="",m.find("result").each(function(){j=B(this),h=j.find("title").text(),y=j.find("md[f='B']").text(),p=j.find("md[f='c']").text(),v=j.find("md[f='y']").text(),x=j.find("live_url").text(),b=j.find("md[f='J']").text(),w=j.find("md[f='K']").text(),C=j.find("md[f='G']").text(),k=j.find("md[f='H']").text(),T=j.find("md[f='I']").text(),j.find("md[f='E']").text(),S=j.find("md[f='M']").text(),g=j.find("md[f='N']").text(),q+='<li class="vevent event"><div class="date"><p class="date-month"><abbr class="dtstart" title="'+y+'">'+k+" "+T+'</abbr></p><p class="date-day-no">'+C+'</p><p class="date-day">'+w+"</p>"+(g="1"===g||"0"===g?"":'<span class="duration">'+g+" days</span>")+'</div><div class="event-details"><h2><a href="'+x+'" title="'+h+'" class="summary">'+h+'</a></h2><p class="time">'+b+'</p><p class="category">Category: '+v+'</p><p class="audience">Open to: '+S+'</p><p class="event-summary">'+p+"</p></div></li>"}),I.html(q)):"news"===E?(n=B(e),u="",n.find("result").each(function(){f=B(this),l=f.find("title").text(),r=0===f.find("md[f='c']").text().length?"":f.find("md[f='c']").text(),f.find("md[f='y']").text(),s=f.find("live_url").text(),o=f.find("md[f='d']").text(),f.find("md[f='E']").text(),d=f.find("md[f='G']").text(),c=0===d.length?"":'<img src="'+d+'"/>',u+='<li class="article">'+c+'<h2><a href="'+s+'" title="'+l+'" class="summary">'+l+"</a></h2><p>"+r+'</p><p class="pub-date">'+o+"</p></li>"}),I.html(u)):N.debug("form type not defined"),M.removeClass("loading").html(Y+" results found for: <strong>"+G+"</strong>")}e=function(){var e={beforeSubmit:d,success:c,dataType:"xml",clearForm:!1,resetForm:!1,url:"//www.city.ac.uk/fb/search.xml?"};a.find("input:checkbox, input:radio").click(function(e){a.submit()}),a.ajaxForm(e)},0!==a.length&&(t.live("click",function(){location.reload()}),B("li",I).live("click",function(){return window.location=B(this).find("a").attr("href"),!1}),a.find("input").attr("autocomplete","off"),B(".apply-filter",a).remove(),a.find(".secondary-filters").hide().after(B('<a href="#" class="reveal">Show All...</a>')),B(".reveal").live("click",function(e){var t=B(e.target),a=B(e.target).prev();return t.hasClass("active")?(t.removeClass("active").text("Show More..."),a.hide()):(t.addClass("active").text("Show Fewer..."),a.show("slow")),!1}),s(),N.initMultiAccordion("h3",a,1),yepnope({load:"lib/jquery/plugins/jquery.form.js",callback:e}),N.searchAutoComplete(a,A,i))}}}(CITY,jQuery),CITY.indexPage.init();