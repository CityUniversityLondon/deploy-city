CITY.library=function(D){"use strict";var e=D(".library-search"),i=e.find(".dropdown-select"),s=i.find(".display").find("span"),r=e.find(".search-refine-wrapper input"),t=D("[data-library-id]").length,a=D(".opening-times-navigation .calendarNavLink"),n=D(".opening-times-panel--left > h3"),T=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],d=function(e){var t=D(e.target).prop("selectedIndex");r.prop("checked",!1),r.eq(t).prop("checked",!0)},o=function(e){var t,a,n=D(e.target);e.preventDefault(),i.toggleClass("active"),n.hasClass("option")&&(n.attr("data-value"),a=n.index(),t=n.html(),r.prop("checked",!1),r.eq(a).prop("checked",!0),s.html(t),i.removeClass("active"))},E=function(e,t){return new Date(e.getTime()+24*t*60*60*1e3)},A=function(e){var t=e.getDate(),a=e.getMonth()+1;return t<10&&(t="0"+t),a<10&&(a="0"+a),e.getFullYear()+"-"+a+"-"+t},w=function(e){return{0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"}[e.getMonth()]},_=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},l=function(e){var t,a=new XMLHttpRequest,n="https://www.city.ac.uk/api/library-opening-times/current-week/_nocache?SQ_CALENDAR_VIEW=week&SQ_CALENDAR_DATE="+(e.week||"");a.open("GET",n,!0),a.onreadystatechange=function(){4===this.readyState&&(200<=this.status&&this.status<400?(t=JSON.parse(this.responseText),p({data:t,todayClean:t.todayClean,todayDay:t.todayDay,queryWeek:t.queryWeek,updateElements:e.updateElements})):{error:!0})},a.send(),a=null,e.updateElements.addClass("opening-times-busy")},p=function(n){var i,s,r,d,o,l,e=D("[data-times-type=daily]"),t=D("[data-times-type=weekly]"),a=D("[data-times-type=call-to-action]"),p="",m="",c=n.updateElements;0<e.length?c.each(function(){var e=D(this),t=e.attr("data-library-id"),a=n.data.libraries[t].times[n.todayDay];r=a.special,d=a.date,o=a.startTime,l=a.endTime,D(".opening-times--home-controls h2 a time").html(n.todayClean),s=e.find(".opening-times--home-list-item-times"),p="closed"===r?"<span><em>Closed</em></span>":"open24hours"===r?"<span><em>Open 24 hours</em></span>":'<time datetime="'+d+"T"+o.replace(".",":")+'">'+o+'</time><span> &ndash; </span><time datetime="'+d+"T"+l.replace(".",":")+'">'+l+"</time>",s.html(p),e.removeClass("opening-times-busy")}):0<t.length?function(k,e){e.each(function(){for(var e,t,a,n,i,s,r,d,o,l,p,m,c,u,h=D(this),y=h.attr("data-library-id"),g=k.data.libraries[y],f=(g.times,h.find(".opening-times-list-card .opening-times-panel--left .opening-times-table tbody")),v="",b="",C=0;C<T.length;C++)g.times[T[C]]?(t=(e=g.times[T[C]]).special,a=e.date,n=e.dateClean.split(",",1),i=e.startTime,s=e.endTime,v+=e.isToday?'<tr data-date="'+n+'" class="is-today">':'<tr data-date="'+n+'">',v+="<td><span>"+_(T[C])+"</span></td>",v+="<td>",v+="closed"===t?"<span><em>Closed</em></span>":"open24hours"===t?"<span><em>Open 24 hours</em></span>":'<time datetime="'+a+"T"+i.replace(".",":")+'">'+i+'</time><span> &ndash; </span><time datetime="'+a+"T"+s.replace(".",":")+'">'+s+"</time>",v+="</td>"):(v+="<tr>",v+="<td><span>"+_(T[C])+"</span></td>",v+="<td><span>No time availalble</span></td>"),v+="</tr>";b=""!==k.queryWeek?(r=k.queryWeek.split("-"),d=new Date(r[0],r[1]-1,r[2]),o=E(d,6),l=d.getDate()+" "+w(d)+" until "+o.getDate()+" "+w(o),p=E(d,7),m=A(p),c=E(d,-7),u=A(c),h.find(".opening-times-navigation-previous a").attr("href","?SQ_CALENDAR_VIEW=week&SQ_CALENDAR_DATE="+u),h.find(".opening-times-navigation-next a").attr("href","?SQ_CALENDAR_VIEW=week&SQ_CALENDAR_DATE="+m),l):k.data.currentWeekRange,h.find(".opening-times-navigation-date-range time").text(b).attr("data-toggle","on"),f.html(v),h.removeClass("opening-times-busy")})}(n,c):0<a.length&&c.each(function(){var e,t=D(this),a=t.find(".library-aside-call-to-action-subtitle");i=t.attr("data-library-id"),e=n.data.libraries[i].times[n.todayDay],r=e.special,d=e.date,o=e.startTime,l=e.endTime,s=t.find(".library-aside-call-to-action-title"),"closed"===r?p="Closed":(p="Open",m="open24hours"===r?"24 hours":'until <time datetime="'+d+"T"+l.replace(".",":")+'">'+l+"</time>"),p+=" Today",s.html(p),a.html(m),t.removeClass("opening-times-busy")})};return{init:function(){n.remove(),i.on("click",o),D(".library-search__content-type").change(d),0!==t&&(l({week:"",updateElements:D("[data-times-type]")}),a.on("click",function(e){var t=D(this),a=t.attr("href").split("=")[2],n=t.parents("[data-times-type]");n.hasClass("opening-times-busy")||l({week:a,updateElements:n}),e.preventDefault()}))}}}($),CITY.library.init();