CITY.widgets=function(e){"use strict";var t=CITY.debug,n=CITY.createGallery,i=(CITY.downloadFileTypes,CITY.viewportChanged,function(e,t,n){var i='<i class=" fa fa-caret-left"></i>',o='<i class=" fa fa-caret-right"></i>',a=e.find(".bx-prev"),d=e.find(".bx-next"),r=n?n:"All";a.empty().append(i),d.empty().append(o),t&&a.after('<a href="'+t+'" class="bx-all" >'+r+"</a>"),e.find(".bx-controls-direction").appendTo(e),e.children("h2").addClass("controls-direction"),e.find(".widget-content").addClass("scrollable"),e.removeClass("widget-loading").children(".loading-fa-icon").remove()}),o=function(){var e=$("#news-widget"),t=e.find("#news-results"),n="//www.city.ac.uk/news",o=3;$("#news-results > .article").size()>o?(t.wrapChildren({childElem:".article",sets:o}),t.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(e,n)}})):e.removeClass("widget-loading").children(".loading-fa-icon").remove()},a=function(){var e=$("#events-widget"),t=$("#events-results"),n="//www.city.ac.uk/events",o=3;$(".vevent",t).click(function(){return window.location=$(this).find("a").attr("href"),!1}),$("#events-results > .vevent").size()>o?(t.wrapChildren({childElem:".event",sets:o}),t.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(e,n)}})):e.removeClass("widget-loading").children(".loading-fa-icon").remove()},d=function(){var e,n=$("#flickr-widget"),o=n.find("ul"),a=function(){t("flickr callback..."),$(".widget-content",n).each(function(){var e=$("ul div:first-child",this),t=$(this),i=e.height(),o=e.width();t.addClass("scrollable"),t.stop().animate({"min-height":i}),t.css("width",o),n.removeClass("widget-loading").children(".loading-fa-icon").remove()}),i(n)};n.mouseenter(function(){e||(e=!0,$("a .imageurl",n).each(function(){var e=$(this),t=e.text(),n='<img src="'+t+'" alt="">';e.parent().text("").prepend(n)}),$("p .imageurl",n).each(function(){var e=$(this),t=e.text(),n="background-image: url("+t+");";e.parent().attr("style",n),e.remove()}))}),o.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,minSlides:1,maxSlides:4,slideWidth:330,slideMargin:0,onSliderLoad:function(){a()}})},r=function(){var e=$("#courses-widget"),t=e.find(".widget-content");t.accordion({heightStyle:"content",collapsible:!0,active:!1,animate:!1,icons:{header:"ui-icon-triangle-1-s",headerSelected:"ui-icon-triangle-1-n"},create:function(){i(e)}})},l=function(){var e,n=$("#testimonials-widget"),o=n.find(".widget-content"),a=o.find("ul");return $("li",a).length<2?(t("Less than 2 testimonials, no need for carousel"),void n.removeClass("widget-loading").addClass("widget-one-item").children(".loading-fa-icon").remove()):(e=function(){i(n),n.removeClass("widget-loading").children(".loading-fa-icon").remove()},void a.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){e()}}))},s=function(){var e,n=$("#profiles-widget"),o=n.find(".widget-content"),a=o.find("ul");return $("li",a).length<2?(t("Less than 2 testimonials, no need for carousel"),void n.removeClass("widget-loading").children(".loading-fa-icon").remove()):(e=function(){i(n),n.removeClass("widget-loading").children(".loading-fa-icon").remove()},void a.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){e()}}))},c=function(){var e,n=$("#spotlight-research-widget"),o=n.find(".widget-content"),a=o.find("ul");return $("li",a).length<2?(t("Less than 2 spotlight on research, no need for carousel"),void n.removeClass("widget-loading").addClass("widget-one-item").children(".loading-fa-icon").remove()):(e=function(){i(n),n.removeClass("widget-loading").children(".loading-fa-icon").remove()},void a.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){e()}}))},f=function(){var e=$("#rss-widget"),t=e.find(".widget-content"),n=t.find(".items");n.children().length>1?n.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(e)}}):e.removeClass("widget-loading").children(".loading-fa-icon").remove()},u=function(){var e,t=$("#start_date").val(),n=$("#end_date").val(),i=new Date,o=new Date,a=function(e,t){var n=e.split("/"),i=n[2].split(" ");return t.setFullYear(i[0]),t.setMonth(n[1]-1),t.setDate(n[0]),t};i=a(t,i),o=a(n,o),e=new Date,o>=e&&i<=e?($("#content_on_date").attr("class","widget-content cta-widget-show"),$("#content_out_of_date").attr("class","cta-widget-hide")):($("#content_out_of_date").attr("class","widget-content cta-widget-show"),$("#content_on_date").attr("class","cta-widget-hide"))},g=function(){var e=$("#gallery-widget .gallery");return n(e,!0)},h=function(){$("div.free-text a").unbind("click").click(function(){})},v=function(){var e,n={events:{f:a},news:{f:o},flickr:{f:d},courses:{f:r},testimonials:{f:l},rss:{f:f},gallery:{f:g},cta:{f:u},freetext:{f:h},profiles:{f:s},"spotlight-research":{f:c}};for(e in n)n.hasOwnProperty(e)&&(0===$("#"+e+"-widget").length?t("no "+e+" widget"):"function"!=typeof n[e].f?t("can't find init func of "+e+" widget"):(t("running init func of "+e+" widget"),n[e].f.apply()))};v()}(window);