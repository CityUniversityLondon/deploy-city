CITY.location=function(t,e,a){var i,n,o=e("#labs"),s=e("#content .lab"),l="//"+a.location.host.replace("www","webapps")+"/matrix/services/labstats.php?",r=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})[+\-](\d{2}):(\d{2})$/,d=6e4,c=null,p=function(t){var e,a,i=[],n=[],o=[],s=[],l={};if("pie"===c)for(e in t)"function"!=typeof t[e]&&(a=t[e],o.push(a.name),i.push(a.available),n.push(a.inUse));else for(e in t)"function"!=typeof t[e]&&(a=t[e],o.push('<a href="'+String(a.asset?a.asset.url:"")+'">'+a.name+"</a>"),i.push(a.available),n.push(a.inUse));return"object"==typeof t[0]&&"string"==typeof t[0].last_updated&&(s=r.exec(t[0].last_updated)),l.lab=a,l.available=i,l.inUse=n,l.categories=o,l.date=s,l},u=function(){e.ajax({url:l,cache:!1,crossDomain:!0,data:n,dataType:"jsonp",success:function(t){var e=p(t);"pie"===c?m(e):h(e)}})},b=function(){setTimeout(function(){i.showLoading("loading real time data"),e.ajax({url:l,cache:!1,crossDomain:!0,data:n,dataType:"jsonp",success:function(t){var e=p(t);"pie"===c?i.series[0].setData([["Available",e.lab.available],["Busy",e.lab.inUse]]):(i.series[0].setData(e.available,!1),i.series[1].setData(e.inUse)),i.setTitle(null,{text:"Updated at <b>"+e.date[4]+":"+e.date[5]+"</b> today"}),i.hideLoading(),d=6e4},error:function(){d=1e5},complete:function(){b()}})},d)},h=function(t){i=new Highcharts.Chart({chart:{renderTo:o.attr("id"),defaultSeriesType:"bar",height:600,events:{load:b()}},credits:{enabled:!1,text:"Created by Mayes, Kennedy & Company",href:"http://mayeskennedy.com"},exporting:{enabled:!1},legend:{align:"right"},series:[{name:"Available",data:t.available},{name:"Busy",data:t.inUse}],subtitle:{text:"Updated at <b>"+t.date[4]+":"+t.date[5]+"</b> today ",y:40},title:{text:"Computer Room Availability"},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"<br/>Total: "+this.point.stackTotal}},xAxis:{categories:t.categories},yAxis:{min:0,title:{text:"No. of Computers"}}})},m=function(t){i=new Highcharts.Chart({chart:{renderTo:s.attr("id"),events:{load:b()}},credits:{enabled:!1,text:"Created by Mayes, Kennedy & Company",href:"http://mayeskennedy.com"},exporting:{enabled:!1},legend:{layout:"vertical",x:100,y:70},plotOptions:{pie:{allowPointSelect:!0,dataLabels:{formatter:function(){return"<b>"+this.point.name+"</b>: "+this.point.y}}}},series:[{type:"pie",name:"Computer availability",data:[["Available",t.lab.available],["Busy",t.lab.inUse]]}],subtitle:{text:"Updated at <b>"+t.date[4]+":"+t.date[5]+"</b> today ",y:40},title:{text:"Computer availability"},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>: "+this.point.y}}})},y=function(){s.length?(c="pie",n="id="+s.attr("id").replace("lab-","")):o.length&&(c="column",/cass-rooms/.test(a.location.pathname)?n="cass-rooms":/law-rooms/.test(a.location.pathname)?n="law-rooms":/health-rooms/.test(a.location.pathname)&&(n="health-rooms")),t.load("highcharts",u)};return{init:y}}(CITY,jQuery,window),CITY.location.init();