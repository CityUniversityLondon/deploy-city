CITY.indexPage=function(e,t){var a=function(){function a(){o.find(":radio:checked").add(":checkbox:checked",o).not("#all-dates").not(".hidden").each(function(){var e,a=t(this),i=a.parent().text();e=t('<li class="active-filter"></li>').html('<a href="#" title="remove this filter">'+i+'<span class="close">remove</span></a>').click(function(e){return a.attr("checked",!1),o.submit(),!1}),e.appendTo(h)})}function i(e){var a,i,n,l,r,s,d,o,c,f,m,h,p,v,x="";e.find("result").each(function(){v=t(this),a=v.find("title").text(),s=v.find("md[f='B']").text(),i=v.find("md[f='c']").text(),n=v.find("md[f='y']").text(),l=v.find("live_url").text(),d=v.find("md[f='J']").text(),o=v.find("md[f='K']").text(),c=v.find("md[f='G']").text(),f=v.find("md[f='H']").text(),m=v.find("md[f='I']").text(),h=v.find("md[f='E']").text(),p=v.find("md[f='M']").text(),r=v.find("md[f='N']").text(),r="1"===r||"0"===r?"":'<span class="duration">'+r+" days</span>",x+='<li class="vevent event"><div class="date"><p class="date-month"><abbr class="dtstart" title="'+s+'">'+f+" "+m+'</abbr></p><p class="date-day-no">'+c+'</p><p class="date-day">'+o+"</p>"+r+'</div><div class="event-details"><h2><a href="'+l+'" title="'+a+'" class="summary">'+a+'</a></h2><p class="time">'+d+'</p><p class="category">Category: '+n+'</p><p class="audience">Open to: '+p+'</p><p class="event-summary">'+i+"</p></div></li>"}),u.html(x)}function n(e){var a,i,n,l,r,s,d,o,c,f="";e.find("result").each(function(){c=t(this),a=c.find("title").text(),i=0===c.find("md[f='c']").text().length?"":c.find("md[f='c']").text(),n=c.find("md[f='y']").text(),l=c.find("live_url").text(),d=c.find("md[f='d']").text(),o=c.find("md[f='E']").text(),r=c.find("md[f='G']").text(),s=0===r.length?"":'<img src="'+r+'"/>',f+='<li class="article">'+s+'<h2><a href="'+l+'" title="'+a+'" class="summary">'+a+"</a></h2><p>"+i+'</p><p class="pub-date">'+d+"</p></li>"}),u.html(f)}function l(e,i,n){var l,r;return r=t.param(e),c.val()||(l=e.length,e[0]={name:"",value:""},e[l]={name:"landing",value:"true"}),f.addClass("loading").prepend(x),h.empty("slow"),m.addClass("loading"),d.animate({scrollTop:0},"slow"),a(),h.children().length>=1?p.show():p.hide(),!0}function r(a,l,r,s){return f.removeClass("loading"),u.empty(),x.remove(),c.attr("name","query"),t(a).find("total_matching").each(function(){g=t(this).text()}),C=0!==c.val().length?c.val():"All "+b,0===t(a).find("result").length?(m.html("No results found for: <strong>"+C+"</strong>"),y.addClass("visible").removeClass("hidden"),void u.append(y)):("events"===b||"concerts"===b||"careers"===b?i(t(a)):"news"===b?n(t(a)):e.debug("form type not defined"),void m.removeClass("loading").html(g+" results found for: <strong>"+C+"</strong>"))}var s,d=t("html, body"),o=t(".index-form"),c=t("#index-query",o),f=t("#results-wrapper"),u=f.find("#results"),m=t("#current-query"),h=t("#active-filters"),p=t("#filtered-by"),v=t("#reload"),x=t("<span/>",{"class":"loader",id:"course-loader",text:"loading..."}),g=null,y=t("<li/>",{"class":"no-results hidden",html:'<p>Sorry, your search has resulted in 0 matches. Try selecting fewer filters or <a href="" id="reload">Start Again<span>Refresh Page</span></a>'}),b=o.attr("id").replace("-form",""),w=o.find("#collection").val(),C=null;s=function(){var e={beforeSubmit:l,success:r,dataType:"xml",clearForm:!1,resetForm:!1,url:"//www.city.ac.uk/fb/search.xml?"};o.find("input:checkbox, input:radio").click(function(e){o.submit()}),o.ajaxForm(e)},0!==o.length&&(v.live("click",function(){location.reload()}),t("li",u).live("click",function(){return window.location=t(this).find("a").attr("href"),!1}),o.find("input").attr("autocomplete","off"),t(".apply-filter",o).remove(),o.find(".secondary-filters").hide().after(t('<a href="#" class="reveal">Show All...</a>')),t(".reveal").live("click",function(e){var a=t(e.target),i=t(e.target).prev();return a.hasClass("active")?(a.removeClass("active").text("Show More..."),i.hide()):(a.addClass("active").text("Show Fewer..."),i.show("slow")),!1}),a(),e.initMultiAccordion("h3",o,1),yepnope({load:"lib/jquery/plugins/jquery.form.js",callback:s}),e.searchAutoComplete(o,c,w))},i={init:a};return i}(CITY,jQuery),CITY.indexPage.init();