CITY.profiles=function(){var a,e,s,i,l="profiles",t="profiles",r=$("#content"),n=$(".subfamily-choice"),p=$("#fb-profiles-wrapper #results-wrapper ol"),f=$("#fb-profiles-wrapper").attr("data-family"),o=function(){r.on("click",".display-filters a",function(a){$.bbq.removeState($(this).parent("li").attr("data-filter").split("=")[0]),a.preventDefault()})},d=function(r){p.addClass("js-load-hide").append($('<i class="fa fa-refresh fa-spin loading-fa-icon"></i>')),e=$.param.fragment(),s=$.deparam(e),""===e&&void 0===r?p.hide().fadeIn(800).removeClass("js-load-hide").children(".loading-fa-icon").remove():$.ajax({url:"/fb/search.html?"+e+"&collection="+l+"&form="+t+"&meta_B_orsand="+f+"&simpleResults=true&sort=metaK&bustCache="+Math.random(),success:function(e){p.empty().append(e).hide().fadeIn(800).removeClass("js-load-hide"),a.find("li").remove(),$.each(s,function(e,s){"meta_C_orsand"===e?(i=s.replace("[","").replace(/"/g,"").replace("]","").split(","),$.each(i,function(a,e){n.find('li a[class="'+e.replace(/ /g,"-")+'"]').addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden">remove filter</span></span>'),p.find(".subfamily a[data-filter=\"meta_C_orsand=['"+e+"']\"]").addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden" remove filter</span></span>')})):(a.append("<li data-filter="+e+'><a href="#">'+s.replace(/"/g,"")+'<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden">remove filter</span></span></a></li>'),p.find('.tag-list a[data-filter="'+e+"="+s+'"]').addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden" remove filter</span></span>'))})}})},c=function(){r.on("click",".tag-list a, .subfamily-choice a",function(a){var e,s,i,l,t,r=$(this),p=$.deparam.fragment(),f=[];r.parents("ul:eq(0)").hasClass("tag-list")?(l=r.attr("data-filter"),s=l.split("=")[0],i=l.split("=")[1],r.hasClass("active")?(r.parent("li").hasClass("subfamily")?(t=r.attr("data-family-filter"),f=p.meta_C_orsand.replace("[","").replace("]","").split(","),f.splice($.inArray('"'+t+'"',f),1).join(","),e="meta_C_orsand=["+f+"]",$.bbq.pushState(e),n.find("a."+t).removeClass("active").find(".remove-filter").remove()):$.bbq.removeState(l.split("=")[0]),r.removeClass("active").find(".remove-filter").remove()):$.bbq.pushState(l)):(t=r.attr("data-family-filter"),r.hasClass("active")?(f=p.meta_C_orsand.replace("[","").replace("]","").split(","),f.splice($.inArray('"'+t+'"',f),1).join(","),r.removeClass("active").find(".remove-filter").remove(),e=0===f.length?"meta_C_orsand=":"meta_C_orsand=["+f+"]"):(void 0===p.meta_C_orsand||""===p.meta_C_orsand.replace("[","").replace("]","").split(",")[0]?f='"'+t+'"':(f=p.meta_C_orsand.replace("[","").replace("]","").split(","),f.push('"'+t+'"'),f.join(",")),e="meta_C_orsand=["+f+"]"),$.bbq.pushState(e)),a.preventDefault()})};$("#results-wrapper").before('<ul class="display-filters"></ul>'),a=$(".display-filters"),c(),d(),o(),$(window).on("hashchange",function(a){d(a)})}(CITY.debug);