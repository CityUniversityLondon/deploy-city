CITY.buildingTheVision=function(){var latlng=new google.maps.LatLng(51.527361,(-.102365)),url="https://www.city.ac.uk/visit/feeds/locations.json?callback=?",mapCanvas=document.getElementById("mapCanvas"),$freeTextWidget=$(".widget.free-text"),$accordion=$(".accordion .ui-accordion-header"),mapOptions={zoom:17,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(mapCanvas,mapOptions),init=function(o){$.each(o,function(o,n){processContent(o,n),processMarkers(o,n),processPolygons(o,n)})},infoWindow,processMarkers=function(o,n){if("Mechanical/Electrical Infrastructure Project"!==n.title&&n.constructionurl){var e,t=new google.maps.LatLng(parseFloat(n.geoLat),parseFloat(n.geoLong)),i=new google.maps.Marker({position:t,animation:google.maps.Animation.DROP,title:n.title,icon:n.icon}),a=unescape(n.description.replace(/\+/g," ")),s=function(o){return e=o?{content:"<b>"+n.title+"</b><br />"+a+"<br /><b>Dates:</b> "+n.constructionBegins.split(" ")[0]+" - "+n.constructionFitComplete.split(" ")[0]+" <br /><a href='"+n.constructionurl+"'>More Information...</a>",maxWidth:300}:{content:"<b>"+n.title+"</b><br />"+a,maxWidth:300}};i.setMap(map),google.maps.event.addListener(i,"mousedown",function(){infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow(s(n.projectLocation)),infoWindow.open(map,i)})}},polygons=[],processContent=function(o,n){var e,t=n.polygon.replace(/\s{2,}/g," "),i=[],a=[],s="";for(i=t.split(" "),e=0;e<i.length;e+=2)s+="new google.maps.LatLng("+i[e]+","+i[e+1]+"),";a.push(s),polygons.push("["+a+"]")},processPolygons=function(i,v){var polygon;""!==v.polygon&&v.constructionurl&&(polygon=new google.maps.Polygon({paths:eval(polygons[i]),strokeOpacity:.8,strokeWeight:1,fillOpacity:.35}),$accordion.each(function(l,k){$.trim($(k).text())===$.trim(v.title)&&$(k).click(function(){polygon.setPath(eval(polygons[i])),polygon.setMap(map),map.setZoom(18),map.setCenter(new google.maps.LatLng(v.geoLat,v.geoLong)),$freeTextWidget.find(".widget-content .hidden").attr("class","visible"),window.innerWidth<500&&$("html, body").animate({scrollTop:$(mapCanvas).offset().top},500)})}),widgetButtons(v,polygon))},widgetButtons=function(o,n){$freeTextWidget.find(".removeButton").click(function(){n.setMap(null),$freeTextWidget.find(".widget-content .visible").attr("class","hidden")}),$freeTextWidget.find(".newButton").click(function(){n.setMap(map),$freeTextWidget.find(".widget-content .hidden").attr("class","visible")})};$.ajax({type:"GET",url:url,async:!1,jsonpCallback:"jsonCallback",contentType:"application/json",dataType:"jsonp",success:function(o){init(o.buildings)},error:function(o){console.error(o.message)}})}(CITY.debug);