!function(e,t){"object"==typeof exports&&exports?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Mustache={})}(this,function(x){var t=Object.prototype.toString,U=Array.isArray||function(e){return"[object Array]"===t.call(e)};function f(e){return"function"==typeof e}function m(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var r=RegExp.prototype.test;var s=/\S/;function E(e){return t=s,n=e,!r.call(t,n);var t,n}var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};var T=/\s*/,j=/\s+/,C=/\s*=/,A=/\s*\}/,R=/#|\^|\/|>|\{|&|=|!/;function S(e){this.string=e,this.tail=e,this.pos=0}function i(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function e(){this.cache={}}S.prototype.eos=function(){return""===this.tail},S.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},S.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},i.prototype.push=function(e){return new i(e,this)},i.prototype.lookup=function(e){var t,n=this.cache;if(e in n)t=n[e];else{for(var r,s,i=this;i;){if(0<e.indexOf("."))for(t=i.view,r=e.split("."),s=0;null!=t&&s<r.length;)t=t[r[s++]];else t=i.view[e];if(null!=t)break;i=i.parent}n[e]=t}return f(t)&&(t=t.call(this.view)),t},e.prototype.clearCache=function(){this.cache={}},e.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=function(e,t){if(!e)return[];var n,r,s,i=[],o=[],a=[],c=!1,u=!1;function h(){if(c&&!u)for(;a.length;)delete o[a.pop()];else a=[];u=c=!1}function l(e){if("string"==typeof e&&(e=e.split(j,2)),!U(e)||2!==e.length)throw new Error("Invalid tags: "+e);n=new RegExp(m(e[0])+"\\s*"),r=new RegExp("\\s*"+m(e[1])),s=new RegExp("\\s*"+m("}"+e[1]))}l(t||x.tags);for(var p,f,g,v,w,d,k=new S(e);!k.eos();){if(p=k.pos,g=k.scanUntil(n))for(var y=0,b=g.length;y<b;++y)E(v=g.charAt(y))?a.push(o.length):u=!0,o.push(["text",v,p,p+1]),p+=1,"\n"===v&&h();if(!k.scan(n))break;if(c=!0,f=k.scan(R)||"name",k.scan(T),"="===f?(g=k.scanUntil(C),k.scan(C),k.scanUntil(r)):"{"===f?(g=k.scanUntil(s),k.scan(A),k.scanUntil(r),f="&"):g=k.scanUntil(r),!k.scan(r))throw new Error("Unclosed tag at "+k.pos);if(w=[f,g,p,k.pos],o.push(w),"#"===f||"^"===f)i.push(w);else if("/"===f){if(!(d=i.pop()))throw new Error('Unopened section "'+g+'" at '+p);if(d[1]!==g)throw new Error('Unclosed section "'+d[1]+'" at '+p)}else"name"===f||"{"===f||"&"===f?u=!0:"="===f&&l(g)}if(d=i.pop())throw new Error('Unclosed section "'+d[1]+'" at '+k.pos);return function(e){for(var t,n=[],r=n,s=[],i=0,o=e.length;i<o;++i)switch((t=e[i])[0]){case"#":case"^":r.push(t),s.push(t),r=t[4]=[];break;case"/":s.pop()[5]=t[2],r=0<s.length?s[s.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],s=0,i=e.length;s<i;++s)(t=e[s])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(o))}(e,t)),r},e.prototype.render=function(e,t,n){var r=this.parse(e),s=t instanceof i?t:new i(t);return this.renderTokens(r,s,n,e)},e.prototype.renderTokens=function(e,t,n,r){var s,i,o="",a=this;function c(e){return a.render(e,t,n)}for(var u=0,h=e.length;u<h;++u)switch((s=e[u])[0]){case"#":if(!(i=t.lookup(s[1])))continue;if(U(i))for(var l=0,p=i.length;l<p;++l)o+=this.renderTokens(s[4],t.push(i[l]),n,r);else if("object"==typeof i||"string"==typeof i)o+=this.renderTokens(s[4],t.push(i),n,r);else if(f(i)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(i=i.call(t.view,r.slice(s[3],s[5]),c))&&(o+=i)}else o+=this.renderTokens(s[4],t,n,r);break;case"^":(!(i=t.lookup(s[1]))||U(i)&&0===i.length)&&(o+=this.renderTokens(s[4],t,n,r));break;case">":if(!n)continue;null!=(i=f(n)?n(s[1]):n[s[1]])&&(o+=this.renderTokens(this.parse(i),t,n,i));break;case"&":null!=(i=t.lookup(s[1]))&&(o+=i);break;case"name":null!=(i=t.lookup(s[1]))&&(o+=x.escape(i));break;case"text":o+=s[1]}return o},x.name="mustache.js",x.version="0.8.1",x.tags=["{{","}}"];var o=new e;x.clearCache=function(){return o.clearCache()},x.parse=function(e,t){return o.parse(e,t)},x.render=function(e,t,n){return o.render(e,t,n)},x.to_html=function(e,t,n,r){var s=x.render(e,t,n);if(!f(r))return s;r(s)},x.escape=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return n[e]})},x.Scanner=S,x.Context=i,x.Writer=e});