!function(t){"use strict";var e,i={form:"#ss-form",results:"#ss-results",resultsItem:"#ss-results-target .results-item",workingClass:"ss-working",pagination:"#ss-pagination",paginationNext:"#ss-pagination a.next",nextId:"ss-next",pageClass:"page",scrollToTopId:"ss-top",formSerializeCallback:null,action:null,initialLoadCallback:null,beforeLoadCallback:null,afterLoadCallback:null,afterDrawCallback:null},a=[],n=!1,o=!1,s={init:function(e){if(i=t.extend(i,e),!1===r.call(this))return!1;l.call(this),c.call(this),f.call(this),d.call(this);var a=window.location.hash.replace(/^#/,"");if(a)if(u.call(this),"function"==typeof i.initialLoadCallback){var n=i.initialLoadCallback.call(this,a);!1!==n&&p(n)}else t(i.results).empty(),t("#"+i.nextId).hide(),b();return this}},r=function(){if("object"!=typeof t.bbq)return t.error("jQuery.ss requires jQuery.bbq"),!1;if(1!==this.length||"form"!==this.get(0).tagName.toLowerCase()||"string"!=typeof this.attr("id"))return t.error("jQuery.ss must be attached to a single form with an id"),!1;var e=this.attr("method");return"string"!=typeof e||"get"===e.toLowerCase()||(t.error("jQuery.ss requires the form method to be GET"),!1)},l=function(){i.form="#"+this.attr("id"),this.submit(function(){var e=t(this).serialize();"function"==typeof i.formSerializeCallback&&(e=i.formSerializeCallback.call(this,e));var n="#"+e;return n!==window.location.hash&&(a=[],t(i.results).empty(),t("#"+i.nextId).hide(),t.bbq.pushState(n)),!1}),this.find("input[type=checkbox], input[type=radio], input[type=button], button").click(function(){t(i.form).submit()})},c=function(){t(window).bind("scroll",m),t(window).bind("hashchange",b)},f=function(){t(i.results).after(t("<a/>",{id:i.nextId,html:"Load more",href:t(i.paginationNext).length?t(i.paginationNext).attr("href"):"javascript:;",click:function(){var e=y(t(this).attr("href"));return!1!==e&&(t.bbq.pushState("#"+e),!1)},style:t(i.paginationNext).is(":visible")?null:"display:none;"})),t(i.pagination).remove()},d=function(){t(document.body).append(t("<a/>",{id:i.scrollToTopId,html:"<span>Scroll to top</span>",style:"position:fixed",click:function(){t("html, body").animate({scrollTop:0},"slow")}}))},u=function(){var e=t.deparam.fragment();t(i.form).find("input[type=checkbox], input[type=radio]").attr("checked",!1),t(i.form).find("input[type=text], input[type=password]").val(""),t(i.form).find("textarea").text(""),t(i.form).find("select option").attr("selected",!1),t(i.form).find("input").each(function(){if(t(this).attr("name")in e)switch(t(this).attr("type").toLowerCase()){case"checkbox":case"radio":e[t(this).attr("name")]==t(this).val()&&(t(this).attr("checked",!1),t(this).click());break;default:t(this).val(e[t(this).attr("name")]),t(this).change()}}),t(i.form).find("select").each(function(){var i=t(this);i.attr("name")in e&&(i.find("option").attr("selected",!1),i.find("option").each(function(){e[i.attr("name")]==t(this).val()&&t(this).attr("selected",!0)}))}),t(i.form).find("textarea").each(function(){t(this).attr("name")in t.deparam.fragment()&&t(this).html(e[t(this).attr("name")])})},h=function(a,n,s){"function"==typeof i.afterLoadCallback?i.afterLoadCallback.call(e):g(),a=a.replace(/(<body[^>]*>)/i,"$1<div>").replace(/(<\/body>)/i,"</div>$1"),t(i.results).append(t("<div/>",{class:i.pageClass,hash:window.location.hash,html:t(i.results,a).html()})),"function"==typeof i.afterDrawCallback&&i.afterDrawCallback.call(e),t(i.paginationNext,a).length?t("#"+i.nextId).show().attr("href",t(i.paginationNext,a).attr("href")):t("#"+i.nextId).hide(),o&&(o=!1,t(window).scrollTop(t(i.results).find("div."+i.pageClass+":last").offset().top))},p=function(e){n=!0,o=!0,t(i.results).empty(),t("#"+i.nextId).hide(),t.ajax({url:"string"==typeof i.action?i.action:t(i.form).attr("action"),data:e,success:function(e,a,o){e=e.replace(/(<body[^>]*>)/i,"$1<div>").replace(/(<\/body>)/i,"</div>$1"),t(i.results).append(t(i.results,e).html()),n=!1,b()},error:function(e,i,a){t.error('AJAX failed with "'+i+'" in jQuery.ss')},complete:function(t,e){n=!1},dataType:"html"})},m=function(){t("#"+i.nextId).is(":visible")&&t(window).scrollTop()+t(window).height()>=t("#"+i.nextId).offset().top?t("#"+i.nextId).click():t(i.results).find("."+i.pageClass).each(function(){var e=t(window).scrollTop()+t(window).height();e>=t(this).offset().top&&e<=t(this).offset().top+t(this).height()&&t.bbq.pushState(t(this).attr("hash"))}),t(window).scrollTop()>t(i.results).offset().top?t("#"+i.scrollToTopId).show():t("#"+i.scrollToTopId).hide()},b=function(){if(!n){var o=window.location.hash;if(!(0<=t.inArray(o,a)))return n=!0,"function"==typeof i.beforeLoadCallback?i.beforeLoadCallback.call(e):w(),t.ajax({url:"string"==typeof i.action?i.action:t(i.form).attr("action"),data:o.replace(/^#/,""),success:h,error:function(e,i,a){t.error('AJAX failed with "'+i+'" in jQuery.ss')},complete:function(t,e){n=!1,"success"===e&&a.push(o)},dataType:"html"}),!1}},y=function(e){var i;return null!==(i=/\?(.+)$/.exec(e))?i[1]:(t.error('No query string "'+e+'" somewhere in jQuery.ss'),!1)},w=function(){t(i.form).find("input, select, button").attr("disabled",!0),t("#"+i.nextId).addClass(i.workingClass),t(i.results).addClass(i.workingClass)},g=function(){t(i.form).find("input, select, button").attr("disabled",!1),t("#"+i.nextId).removeClass(i.workingClass),""===t(i.results).text()&&t(i.results).removeClass(i.workingClass)};t.fn.ss=function(i){return e=this,s[i]?s[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error("Method "+i+" does not exist on jQuery.ss"):s.init.apply(this,arguments)}}(jQuery);