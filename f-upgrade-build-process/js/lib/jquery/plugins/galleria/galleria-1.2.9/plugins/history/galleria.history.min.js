!function(n,t){var a,e,i,o,r,c,s,u,h,l,f,d,y;Galleria.requires(1.25,"The History Plugin requires Galleria version 1.2.5 or later."),Galleria.History=(e=[],i=!1,o=t.location,r=t.document,c=Galleria.IE,s="onhashchange"in t&&(void 0===r.mode||r.mode>7),h=(u=function(n){return n=a&&!s&&Galleria.IE?n||a.location:o,parseInt(n.hash.substr(2),10)})(o),l=[],f=function(){n.each(l,function(n,a){a.call(t,u())})},d=function(){n.each(e,function(n,t){t()}),i=!0},y=function(n){return"/"+n},s&&c<8&&(s=!1),s?d():n(function(){t.setInterval(function(){var n=u();isNaN(n)||n==h||(h=n,o.hash=y(n),f())},50),c?n('<iframe tabindex="-1" title="empty">').hide().attr("src","about:blank").one("load",function(){a=this.contentWindow,d()}).insertAfter(r.body):d()}),{change:function(n){l.push(n),s&&(t.onhashchange=f)},set:function(n){isNaN(n)||(!s&&c&&this.ready(function(){var t=a.document;t.open(),t.close(),a.location.hash=y(n)}),o.hash=y(n))},ready:function(n){i?n():e.push(n)}})}(jQuery,this);   });
            },
            ready = function() {
                $.each(onloads, function(i, fn) {
                    fn();
                });
                init = true;
            },
            setHash = function(val) {
                return '/' + val;
            };
        if (support && ie < 8) {
            support = false;
        }
        if (!support) {
            $(function() {
                var interval = window.setInterval(function() {
                    var hash = get();
                    if (!isNaN(hash) && hash != saved) {
                        saved = hash;
                        loc.hash = setHash(hash);
                        onchange();
                    }
                }, 50);
                if (ie) {
                    $('<iframe tabindex="-1" title="empty">')
                        .hide()
                        .attr('src', 'about:blank')
                        .one('load', function() {
                            iframe = this.contentWindow;
                            ready();
                        })
                        .insertAfter(doc.body);
                } else {
                    ready();
                }
            });
        } else {
            ready();
        }
        return {
            change: function(fn) {
                callbacks.push(fn);
                if (support) {
                    window.onhashchange = onchange;
                }
            },
            set: function(val) {
                if (isNaN(val)) {
                    return;
                }
                if (!support && ie) {
                    this.ready(function() {
                        var idoc = iframe.document;
                        idoc.open();
                        idoc.close();
                        iframe.location.hash = setHash(val);
                    });
                }
                loc.hash = setHash(val);
            },
            ready: function(fn) {
                if (!init) {
                    onloads.push(fn);
                } else {
                    fn();
                }
            },
        };
    })();
})(jQuery, this);
