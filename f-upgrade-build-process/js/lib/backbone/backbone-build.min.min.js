(function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,s=Function.prototype,o=n.push,a=n.slice,l=n.concat,u=r.toString,c=r.hasOwnProperty,h=n.forEach,d=n.map,f=n.reduce,p=n.reduceRight,g=n.filter,v=n.every,m=n.some,y=n.indexOf,_=n.lastIndexOf,w=Array.isArray,b=Object.keys,x=s.bind,E=function(t){return t instanceof E?t:this instanceof E?void(this._wrapped=t):new E(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.4.4";var C=E.each=E.forEach=function(t,e,n){if(null!=t)if(h&&t.forEach===h)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var o in t)if(E.has(t,o)&&e.call(n,t[o],o,t)===i)return};E.map=E.collect=function(t,e,i){var n=[];return null==t?n:d&&t.map===d?t.map(e,i):(C(t,function(t,r,s){n.push(e.call(i,t,r,s))}),n)};var M="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduce===f)return n&&(e=E.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(C(t,function(t,s,o){r?i=e.call(n,i,t,s,o):(i=t,r=!0)}),!r)throw new TypeError(M);return i},E.reduceRight=E.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return n&&(e=E.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var o=E.keys(t);s=o.length}if(C(t,function(a,l,u){l=o?o[--s]:--s,r?i=e.call(n,i,t[l],l,u):(i=t[l],r=!0)}),!r)throw new TypeError(M);return i},E.find=E.detect=function(t,e,i){var n;return P(t,function(t,r,s){return e.call(i,t,r,s)?(n=t,!0):void 0}),n},E.filter=E.select=function(t,e,i){var n=[];return null==t?n:g&&t.filter===g?t.filter(e,i):(C(t,function(t,r,s){e.call(i,t,r,s)&&n.push(t)}),n)},E.reject=function(t,e,i){return E.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},E.every=E.all=function(t,e,n){e||(e=E.identity);var r=!0;return null==t?r:v&&t.every===v?t.every(e,n):(C(t,function(t,s,o){return(r=r&&e.call(n,t,s,o))?void 0:i}),!!r)};var P=E.some=E.any=function(t,e,n){e||(e=E.identity);var r=!1;return null==t?r:m&&t.some===m?t.some(e,n):(C(t,function(t,s,o){return r||(r=e.call(n,t,s,o))?i:void 0}),!!r)};E.contains=E.include=function(t,e){return null!=t&&(y&&t.indexOf===y?-1!=t.indexOf(e):P(t,function(t){return t===e}))},E.invoke=function(t,e){var i=a.call(arguments,2),n=E.isFunction(e);return E.map(t,function(t){return(n?e:t[e]).apply(t,i)})},E.pluck=function(t,e){return E.map(t,function(t){return t[e]})},E.where=function(t,e,i){return E.isEmpty(e)?i?void 0:[]:E[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},E.findWhere=function(t,e){return E.where(t,e,!0)},E.max=function(t,e,i){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&E.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return C(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o>=n.computed&&(n={value:t,computed:o})}),n.value},E.min=function(t,e,i){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&E.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return C(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o<n.computed&&(n={value:t,computed:o})}),n.value},E.shuffle=function(t){var e,i=0,n=[];return C(t,function(t){e=E.random(i++),n[i-1]=n[e],n[e]=t}),n};var R=function(t){return E.isFunction(t)?t:function(e){return e[t]}};E.sortBy=function(t,e,i){var n=R(e);return E.pluck(E.map(t,function(t,e,r){return{value:t,index:e,criteria:n.call(i,t,e,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var I=function(t,e,i,n){var r={},s=R(null==e?E.identity:e);return C(t,function(e,o){var a=s.call(i,e,o,t);n(r,a,e)}),r};E.groupBy=function(t,e,i){return I(t,e,i,function(t,e,i){(E.has(t,e)?t[e]:t[e]=[]).push(i)})},E.countBy=function(t,e,i){return I(t,e,i,function(t,e){E.has(t,e)||(t[e]=0),t[e]++})},E.sortedIndex=function(t,e,i,n){for(var r=(i=null==i?E.identity:R(i)).call(n,e),s=0,o=t.length;o>s;){var a=s+o>>>1;i.call(n,t[a])<r?s=a+1:o=a}return s},E.toArray=function(t){return t?E.isArray(t)?a.call(t):t.length===+t.length?E.map(t,E.identity):E.values(t):[]},E.size=function(t){return null==t?0:t.length===+t.length?t.length:E.keys(t).length},E.first=E.head=E.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:a.call(t,0,e)},E.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},E.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},E.rest=E.tail=E.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},E.compact=function(t){return E.filter(t,E.identity)};var F=function(t,e,i){return C(t,function(t){E.isArray(t)?e?o.apply(i,t):F(t,e,i):i.push(t)}),i};E.flatten=function(t,e){return F(t,e,[])},E.without=function(t){return E.difference(t,a.call(arguments,1))},E.uniq=E.unique=function(t,e,i,n){E.isFunction(e)&&(n=i,i=e,e=!1);var r=i?E.map(t,i,n):t,s=[],o=[];return C(r,function(i,n){(e?n&&o[o.length-1]===i:E.contains(o,i))||(o.push(i),s.push(t[n]))}),s},E.union=function(){return E.uniq(l.apply(n,arguments))},E.intersection=function(t){var e=a.call(arguments,1);return E.filter(E.uniq(t),function(t){return E.every(e,function(e){return E.indexOf(e,t)>=0})})},E.difference=function(t){var e=l.apply(n,a.call(arguments,1));return E.filter(t,function(t){return!E.contains(e,t)})},E.zip=function(){for(var t=a.call(arguments),e=E.max(E.pluck(t,"length")),i=new Array(e),n=0;e>n;n++)i[n]=E.pluck(t,""+n);return i},E.unzip=function(t){var e=E.max(E.pluck(t,"length"));return E.times(e,E.partial(E.pluck,t))},E.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},E.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return t[n=E.sortedIndex(t,e)]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(y&&t.indexOf===y)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},E.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(_&&t.lastIndexOf===_)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},E.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=new Array(n);n>r;)s[r++]=t,t+=i;return s};var V=function(){};E.bind=function(t,e){var i,n;if(t.bind===x&&x)return x.apply(t,a.call(arguments,1));if(!E.isFunction(t))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(a.call(arguments)));V.prototype=t.prototype;var r=new V;V.prototype=null;var s=t.apply(r,i.concat(a.call(arguments)));return Object(s)===s?s:r}},E.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},E.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return C(e,function(e){t[e]=E.bind(t[e],t)}),t},E.memoize=function(t,e){var i={};return e||(e=E.identity),function(){var n=e.apply(this,arguments);return E.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},E.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},E.defer=function(t){return E.delay.apply(E,[t,1].concat(a.call(arguments,1)))},E.throttle=function(t,e,i){var n,r,s,o,a=0,l=function(){a=new Date,s=null,o=t.apply(n,r)};return function(){var u=new Date;a||!1!==i||(a=u);var c=e-(u-a);return n=this,r=arguments,0>=c?(clearTimeout(s),s=null,a=u,o=t.apply(n,r)):s||(s=setTimeout(l,c)),o}},E.debounce=function(t,e,i){var n,r;return function(){var s=this,o=arguments,a=i&&!n;return clearTimeout(n),n=setTimeout(function(){n=null,i||(r=t.apply(s,o))},e),a&&(r=t.apply(s,o)),r}},E.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},E.wrap=function(t,e){return function(){var i=[t];return o.apply(i,arguments),e.apply(this,i)}},E.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},E.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},E.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)E.has(t,i)&&e.push(i);return e},E.values=function(t){var e=[];for(var i in t)E.has(t,i)&&e.push(t[i]);return e},E.pairs=function(t){var e=[];for(var i in t)E.has(t,i)&&e.push([i,t[i]]);return e},E.invert=function(t){var e={};for(var i in t)E.has(t,i)&&(e[t[i]]=i);return e},E.functions=E.methods=function(t){var e=[];for(var i in t)E.isFunction(t[i])&&e.push(i);return e.sort()},E.extend=function(t){return C(a.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},E.pick=function(t){var e={},i=l.apply(n,a.call(arguments,1));return C(i,function(i){i in t&&(e[i]=t[i])}),e},E.omit=function(t){var e={},i=l.apply(n,a.call(arguments,1));for(var r in t)E.contains(i,r)||(e[r]=t[r]);return e},E.defaults=function(t){return C(a.call(arguments,1),function(e){if(e)for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t};var T=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof E&&(t=t._wrapped),e instanceof E&&(e=e._wrapped);var r=u.call(t);if(r!=u.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;i.push(t),n.push(e);var o=0,a=!0;if("[object Array]"==r){if(a=(o=t.length)==e.length)for(;o--&&(a=T(t[o],e[o],i,n)););}else{var l=t.constructor,c=e.constructor;if(l!==c&&!(E.isFunction(l)&&l instanceof l&&E.isFunction(c)&&c instanceof c))return!1;for(var h in t)if(E.has(t,h)&&(o++,!(a=E.has(e,h)&&T(t[h],e[h],i,n))))break;if(a){for(h in e)if(E.has(e,h)&&!o--)break;a=!o}}return i.pop(),n.pop(),a};E.isEqual=function(t,e){return T(t,e,[],[])},E.isEmpty=function(t){if(null==t)return!0;if(E.isArray(t)||E.isString(t))return 0===t.length;for(var e in t)if(E.has(t,e))return!1;return!0},E.isElement=function(t){return!(!t||1!==t.nodeType)},E.isArray=w||function(t){return"[object Array]"==u.call(t)},E.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){E["is"+t]=function(e){return u.call(e)=="[object "+t+"]"}}),E.isArguments(arguments)||(E.isArguments=function(t){return!(!t||!E.has(t,"callee"))}),"function"!=typeof/./&&(E.isFunction=function(t){return"function"==typeof t}),E.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},E.isNaN=function(t){return E.isNumber(t)&&t!=+t},E.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==u.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return c.call(t,e)},E.noConflict=function(){return t._=e,this},E.identity=function(t){return t},E.times=function(t,e,i){for(var n=Array(Math.max(0,t)),r=0;t>r;r++)n[r]=e.call(i,r);return n},E.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var k={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};k.unescape=E.invert(k.escape);var A={escape:new RegExp("["+E.keys(k.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(k.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(t){E[t]=function(e){return null==e?"":(""+e).replace(A[t],function(e){return k[t][e]})}}),E.result=function(t,e){if(null!=t){var i=t[e];return E.isFunction(i)?i.call(t):i}},E.mixin=function(t){C(E.functions(t),function(e){var i=E[e]=t[e];E.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),z.call(this,i.apply(E,t))}})};var S=0;E.uniqueId=function(t){var e=++S+"";return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","  ":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(t,e,i){var n;i=E.defaults({},i,E.templateSettings);var r=new RegExp([(i.escape||N).source,(i.interpolate||N).source,(i.evaluate||N).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(r,function(e,i,n,r,a){return o+=t.slice(s,a).replace(j,function(t){return"\\"+O[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),s=a+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(t){throw t.source=o,t}if(e)return n(e,E);var a=function(t){return n.call(this,t,E)};return a.source="function("+(i.variable||"obj")+"){\n"+o+"}",a},E.chain=function(t){return E(t).chain()};var z=function(t){return this._chain?E(t).chain():t};E.mixin(E),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];E.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],z.call(this,i)}}),C(["concat","join","slice"],function(t){var e=n[t];E.prototype[t]=function(){return z.call(this,e.apply(this._wrapped,arguments))}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(){var t,e=this,i=e.Backbone,n=[],r=n.push,s=n.slice,o=n.splice;(t="undefined"!=typeof exports?exports:e.Backbone={}).VERSION="1.0.0";var a=e._;a||"undefined"==typeof require||(a=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var l=t.Events={on:function(t,e,i){return c(this,"on",t,[e,i])&&e?(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:e,context:i,ctx:i||this}),this):this},once:function(t,e,i){if(!c(this,"once",t,[e,i])||!e)return this;var n=this,r=a.once(function(){n.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,i)},off:function(t,e,i){var n,r,s,o,l,u,h,d;if(!this._events||!c(this,"off",t,[e,i]))return this;if(!t&&!e&&!i)return this._events={},this;for(l=0,u=(o=t?[t]:a.keys(this._events)).length;u>l;l++)if(t=o[l],s=this._events[t]){if(this._events[t]=n=[],e||i)for(h=0,d=s.length;d>h;h++)r=s[h],(e&&e!==r.callback&&e!==r.callback._callback||i&&i!==r.context)&&n.push(r);n.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!c(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&h(i,e),n&&h(n,arguments),this},stopListening:function(t,e,i){var n=this._listeners;if(!n)return this;var r=!e&&!i;for(var s in"object"==typeof e&&(i=this),t&&((n={})[t._listenerId]=t),n)n[s].off(e,i,this),r&&delete this._listeners[s];return this}},u=/\s+/,c=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)t[e].apply(t,[r,i[r]].concat(n));return!1}if(u.test(i)){for(var s=i.split(u),o=0,a=s.length;a>o;o++)t[e].apply(t,[s[o]].concat(n));return!1}return!0},h=function(t,e){var i,n=-1,r=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e)}};a.each({listenTo:"on",listenToOnce:"once"},function(t,e){l[e]=function(e,i,n){return(this._listeners||(this._listeners={}))[e._listenerId||(e._listenerId=a.uniqueId("l"))]=e,"object"==typeof i&&(n=this),e[t](i,n,this),this}}),l.bind=l.on,l.unbind=l.off,a.extend(t,l);var d=t.Model=function(t,e){var i,n=t||{};e||(e={}),this.cid=a.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),e._attrs=n,(i=a.result(this,"defaults"))&&(n=a.defaults({},n,i)),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};a.extend(d.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return a.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,r,s,o,l,u,c,h;if(null==t)return this;if("object"==typeof t?(r=t,i=e):(r={})[t]=e,i||(i={}),!this._validate(r,i))return!1;for(n in s=i.unset,l=i.silent,o=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=a.clone(this.attributes),this.changed={}),h=this.attributes,c=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]),r)e=r[n],a.isEqual(h[n],e)||o.push(n),a.isEqual(c[n],e)?delete this.changed[n]:this.changed[n]=e,s?delete h[n]:h[n]=e;if(!l){o.length&&(this._pending=!0);for(var d=0,f=o.length;f>d;d++)this.trigger("change:"+o[d],this,h[o[d]],i)}if(u)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,a.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,a.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!a.isEmpty(this.changed):a.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&a.clone(this.changed);var e,i=!1,n=this._changing?this._previousAttributes:this.attributes;for(var r in t)a.isEqual(n[r],e=t[r])||((i||(i={}))[r]=e);return i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(t){void 0===(t=t?a.clone(t):{}).parse&&(t.parse=!0);var e=this,i=t.success;return t.success=function(n){return!!e.set(e.parse(n,t),t)&&(i&&i(e,n,t),void e.trigger("sync",e,n,t))},T(this,t),this.sync("read",this,t)},save:function(t,e,i){var n,r,s,o=this.attributes;if(null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e,i=a.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=a.extend({},o,n)),void 0===i.parse&&(i.parse=!0);var l=this,u=i.success;return i.success=function(t){l.attributes=o;var e=l.parse(t,i);return i.wait&&(e=a.extend(n||{},e)),!(a.isObject(e)&&!l.set(e,i))&&(u&&u(l,t,i),void l.trigger("sync",l,t,i))},T(this,i),"patch"===(r=this.isNew()?"create":i.patch?"patch":"update")&&(i.attrs=n),s=this.sync(r,this,i),n&&i.wait&&(this.attributes=o),s},destroy:function(t){t=t?a.clone(t):{};var e=this,i=t.success,n=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(r){(t.wait||e.isNew())&&n(),i&&i(e,r,t),e.isNew()||e.trigger("sync",e,r,t)},this.isNew())return t.success(),!1;T(this,t);var r=this.sync("delete",this,t);return t.wait||n(),r},url:function(){var t=a.result(this,"urlRoot")||a.result(this.collection,"url")||V();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},a.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=a.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,a.extend(e||{},{validationError:i})),!1)}});a.each(["keys","values","pairs","invert","pick","omit"],function(t){d.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.attributes),a[t].apply(a,e)}});var f=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,a.extend({silent:!0},e))},p={add:!0,remove:!0,merge:!0},g={add:!0,merge:!1,remove:!1};a.extend(f.prototype,l,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,a.defaults(e||{},g))},remove:function(t,e){var i,n,r,s;for(e||(e={}),i=0,n=(t=a.isArray(t)?t.slice():[t]).length;n>i;i++)(s=this.get(t[i]))&&(delete this._byId[s.id],delete this._byId[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,e.silent||(e.index=r,s.trigger("remove",s,this,e)),this._removeReference(s));return this},set:function(t,e){(e=a.defaults(e||{},p)).parse&&(t=this.parse(t,e)),a.isArray(t)||(t=t?[t]:[]);var i,n,s,l,u,c,h=e.at,d=this.comparator&&null==h&&!1!==e.sort,f=a.isString(this.comparator)?this.comparator:null,g=[],v=[],m={},y=e.add,_=e.merge,w=e.remove,b=!(d||!y||!w)&&[];for(i=0,n=t.length;n>i;i++)(s=this._prepareModel(l=t[i],e))&&((u=this.get(s))?(w&&(m[u.cid]=!0),_&&(l=l===s?s.attributes:e._attrs,u.set(l,e),d&&!c&&u.hasChanged(f)&&(c=!0))):y&&(g.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)),b&&b.push(u||s));if(w){for(i=0,n=this.length;n>i;++i)m[(s=this.models[i]).cid]||v.push(s);v.length&&this.remove(v,e)}if((g.length||b&&b.length)&&(d&&(c=!0),this.length+=g.length,null!=h?o.apply(this.models,[h,0].concat(g)):(b&&(this.models.length=0),r.apply(this.models,b||g))),c&&this.sort({silent:!0}),e.silent)return this;for(i=0,n=g.length;n>i;i++)(s=g[i]).trigger("add",s,this,e);return(c||b&&b.length)&&this.trigger("sort",this,e),this},reset:function(t,e){e||(e={});for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return e.previousModels=this.models,this._reset(),this.add(t,a.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:this.length},e)),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,a.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return s.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t.cid||t]},at:function(t){return this.models[t]},where:function(t,e){return a.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),a.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},sortedIndex:function(t,e,i){e||(e=this.comparator);var n=a.isFunction(e)?e:function(t){return t.get(e)};return a.sortedIndex(this.models,t,n,i)},pluck:function(t){return a.invoke(this.models,"get",t)},fetch:function(t){void 0===(t=t?a.clone(t):{}).parse&&(t.parse=!0);var e=t.success,i=this;return t.success=function(n){var r=t.reset?"reset":"set";i[r](n,t),e&&e(i,n,t),i.trigger("sync",i,n,t)},T(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?a.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var i=this,n=e.success;return e.success=function(r){e.wait&&i.add(t,e),n&&n(t,r,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof d)return t.collection||(t.collection=this),t;e||(e={}),e.collection=this;var i=new this.model(t,e);return i._validate(t,e)?i:(this.trigger("invalid",this,t,e),!1)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});a.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"],function(t){f.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.models),a[t].apply(a,e)}});a.each(["groupBy","countBy","sortBy"],function(t){f.prototype[t]=function(e,i){var n=a.isFunction(e)?e:function(t){return t.get(e)};return a[t](this.models,n,i)}});var v=t.View=function(t){this.cid=a.uniqueId("view"),t||(t={}),a.extend(this,a.pick(t,y)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},m=/^(\S+)\s*(.*)$/,y=["model","collection","el","id","attributes","className","tagName","events"];a.extend(v.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=a.result(this,"events")))return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(a.isFunction(i)||(i=this[t[e]]),i){var n=e.match(m),r=n[1],s=n[2];i=a.bind(i,this),r+=".delegateEvents"+this.cid,""===s?this.$el.on(r,i):this.$el.on(r,s,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e.class=a.result(this,"className"));var i=t.$("<"+a.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,n){var r=_[e];a.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:r,dataType:"json"};if(n.url||(s.url=a.result(i,"url")||V()),null!=n.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",n.emulateJSON&&(s.data._method=r);var o=n.beforeSend;n.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",r),o?o.apply(this,arguments):void 0}}"GET"===s.type||n.emulateJSON||(s.processData=!1),"PATCH"!==s.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=t.ajax(a.extend(s,n));return i.trigger("request",i,l,n),l};var _={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var w=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},b=/\((.*?)\)/g,x=/(\(\?)?:\w+/g,E=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(w.prototype,l,{initialize:function(){},route:function(e,i,n){a.isRegExp(e)||(e=this._routeToRegExp(e)),a.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var r=this;return t.history.route(e,function(s){var o=r._extractParameters(e,s);n&&n.apply(r,o),r.trigger.apply(r,["route:"+i].concat(o)),r.trigger("route",i,o),t.history.trigger("route",r,i,o)}),this},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var t,e=a.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(C,"\\$&").replace(b,"(?:$1)?").replace(x,function(t,e){return e?t:"([^/]+)"}).replace(E,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return a.map(i,function(t){return t?decodeURIComponent(t):null})}});var M=t.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},P=/^[#\/]|\s+$/g,R=/^\/+|\/+$/g,I=/msie [\w.]+/,F=/\/$/;M.started=!1,a.extend(M.prototype,l,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(F,"");t.indexOf(i)||(t=t.substr(i.length))}else t=this.getHash();return t.replace(P,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=a.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),n=document.documentMode,r=I.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(R,"/"),r&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var s=this.location,o=s.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!o?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&o&&s.hash&&(this.fragment=this.getHash().replace(P,""),this.history.replaceState({},document.title,this.root+this.fragment+s.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),M.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t!==this.fragment&&(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t);return a.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(t,e){if(!M.started)return!1;if(e&&!0!==e||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var i=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),t.history=new M;d.extend=f.extend=w.extend=v.extend=M.extend=function(t,e){var i,n=this;i=t&&a.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},a.extend(i,n,e);var r=function(){this.constructor=i};return r.prototype=n.prototype,i.prototype=new r,t&&a.extend(i.prototype,t),i.__super__=n.prototype,i};var V=function(){throw new Error('A "url" property or function must be specified')},T=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}}}.call(this),Backbone.ChildViewContainer=function(t,e){var i=function(t){this._views={},this._indexByModel={},this._indexByCollection={},this._indexByCustom={},this._updateLength(),this._addInitialViews(t)};e.extend(i.prototype,{add:function(t,e){var i=t.cid;this._views[i]=t,t.model&&(this._indexByModel[t.model.cid]=i),t.collection&&(this._indexByCollection[t.collection.cid]=i),e&&(this._indexByCustom[e]=i),this._updateLength()},findByModel:function(t){var e=this._indexByModel[t.cid];return this.findByCid(e)},findByCollection:function(t){var e=this._indexByCollection[t.cid];return this.findByCid(e)},findByCustom:function(t){var e=this._indexByCustom[t];return this.findByCid(e)},findByIndex:function(t){return e.values(this._views)[t]},findByCid:function(t){return this._views[t]},remove:function(t){var e,i=t.cid;for(var n in t.model&&delete this._indexByModel[t.model.cid],t.collection&&delete this._indexByCollection[t.collection.cid],this._indexByCustom)if(this._indexByCustom.hasOwnProperty(n)&&this._indexByCustom[n]===i){e=n;break}e&&delete this._indexByCustom[e],delete this._views[i],this._updateLength()},call:function(t,e){e=Array.prototype.slice.call(arguments,1),this.apply(t,e)},apply:function(t,i){i=i||[],e.each(this._views,function(n){e.isFunction(n[t])&&n[t].apply(n,i)})},_updateLength:function(){this.length=e.size(this._views)},_addInitialViews:function(t){if(t){var e,i,n=t.length;for(i=0;n>i;i++)e=t[i],this.add(e)}}});return e.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(t){i.prototype[t]=function(){var i=[e.values(this._views)].concat(e.toArray(arguments));return e[t].apply(e,i)}}),i}(Backbone,_),Backbone.Wreqr=function(t,e,i){"use strict";var n={};return n.Handlers=function(t,e){var i=function(t){this.options=t,this._wreqrHandlers={},e.isFunction(this.initialize)&&this.initialize(t)};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events,{setHandlers:function(t){e.each(t,function(t,i){var n=null;e.isObject(t)&&!e.isFunction(t)&&(n=t.context,t=t.callback),this.setHandler(i,t,n)},this)},setHandler:function(t,e,i){var n={callback:e,context:i};this._wreqrHandlers[t]=n,this.trigger("handler:add",t,e,i)},hasHandler:function(t){return!!this._wreqrHandlers[t]},getHandler:function(t){var e=this._wreqrHandlers[t];if(!e)throw new Error("Handler not found for '"+t+"'");return function(){var t=Array.prototype.slice.apply(arguments);return e.callback.apply(e.context,t)}},removeHandler:function(t){delete this._wreqrHandlers[t]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(t,i),n.CommandStorage=function(){var e=function(t){this.options=t,this._commands={},i.isFunction(this.initialize)&&this.initialize(t)};return i.extend(e.prototype,t.Events,{getCommands:function(t){var e=this._commands[t];return e||(e={command:t,instances:[]},this._commands[t]=e),e},addCommand:function(t,e){this.getCommands(t).instances.push(e)},clearCommands:function(t){this.getCommands(t).instances=[]}}),e}(),n.Commands=function(t){return t.Handlers.extend({storageType:t.CommandStorage,constructor:function(e){this.options=e||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);t.Handlers.prototype.constructor.apply(this,i)},execute:function(t,e){t=arguments[0],e=Array.prototype.slice.call(arguments,1),this.hasHandler(t)?this.getHandler(t).apply(this,e):this.storage.addCommand(t,e)},_executeCommands:function(t,e,n){var r=this.storage.getCommands(t);i.each(r.instances,function(t){e.apply(n,t)}),this.storage.clearCommands(t)},_initializeStorage:function(t){var e,n=t.storageType||this.storageType;e=i.isFunction(n)?new n:n,this.storage=e}})}(n),n.RequestResponse=n.Handlers.extend({request:function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);return this.getHandler(t).apply(this,e)}}),n.EventAggregator=function(t,e){var i=function(){};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events),i}(t,i),n}(Backbone,Backbone.Marionette,_);var Marionette=function(t,e,i){"use strict";function n(t){return o.call(t)}function r(t,e){var i=new Error(t);throw i.name=e||"Error",i}var s={};e.Marionette=s,s.$=e.$;var o=Array.prototype.slice;return s.extend=e.Model.extend,s.getOption=function(t,e){if(t&&e)return t.options&&e in t.options&&void 0!==t.options[e]?t.options[e]:t[e]},s.triggerMethod=function(){function t(t,e,i){return i.toUpperCase()}var e=/(^|:)(\w)/gi;return function(n){var r=this["on"+n.replace(e,t)];return this.trigger.apply(this,arguments),i.isFunction(r)?r.apply(this,i.tail(arguments)):void 0}}(),s.MonitorDOMRefresh=function(){function t(t){t._isShown&&t._isRendered&&i.isFunction(t.triggerMethod)&&t.triggerMethod("dom:refresh")}return function(e){e.listenTo(e,"show",function(){!function(e){e._isShown=!0,t(e)}(e)}),e.listenTo(e,"render",function(){var i;(i=e)._isRendered=!0,t(i)})}}(),function(t){function e(t,e,n,s){var o=s.split(/\s+/);i.each(o,function(i){var s=t[i];s||r("Method '"+i+"' was configured as an event handler, but does not exist."),t.listenTo(e,n,s,t)})}function n(t,e,i,n){t.listenTo(e,i,n,t)}function s(t,e,n,r){var s=r.split(/\s+/);i.each(s,function(){var i=t[i];t.stopListening(e,n,i,t)})}function o(t,e,i,n){t.stopListening(e,i,n,t)}function a(t,e,n,r,s){e&&n&&(i.isFunction(n)&&(n=n.call(t)),i.each(n,function(n,o){i.isFunction(n)?r(t,e,o,n):s(t,e,o,n)}))}t.bindEntityEvents=function(t,i,r){a(t,i,r,n,e)},t.unbindEntityEvents=function(t,e,i){a(t,e,i,o,s)}}(s),s.Callbacks=function(){this._deferred=s.$.Deferred(),this._callbacks=[]},i.extend(s.Callbacks.prototype,{add:function(t,e){this._callbacks.push({cb:t,ctx:e}),this._deferred.done(function(i,n){e&&(i=e),t.call(i,n)})},run:function(t,e){this._deferred.resolve(e,t)},reset:function(){var t=this._callbacks;this._deferred=s.$.Deferred(),this._callbacks=[],i.each(t,function(t){this.add(t.cb,t.ctx)},this)}}),s.Controller=function(t){this.triggerMethod=s.triggerMethod,this.options=t||{},i.isFunction(this.initialize)&&this.initialize(this.options)},s.Controller.extend=s.extend,i.extend(s.Controller.prototype,e.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),s.Region=function(t){if(this.options=t||{},this.el=s.getOption(this,"el"),!this.el){var e=new Error("An 'el' must be specified for a region.");throw e.name="NoElError",e}if(this.initialize){var i=Array.prototype.slice.apply(arguments);this.initialize.apply(this,i)}},i.extend(s.Region,{buildRegion:function(t,e){var n,r,s="string"==typeof t,o="string"==typeof t.selector,a=void 0===t.regionType,l="function"==typeof t;if(!l&&!s&&!o)throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");s&&(n=t),t.selector&&(n=t.selector),l&&(r=t),!l&&a&&(r=e),t.regionType&&(r=t.regionType);var u=new r({el:n});return t.parentEl&&(u.getEl=function(e){var n=t.parentEl;return i.isFunction(n)&&(n=n()),n.find(e)}),u}}),i.extend(s.Region.prototype,e.Events,{show:function(t){this.ensureEl(),t!==this.currentView?(this.close(),t.render(),this.open(t)):t.render(),s.triggerMethod.call(t,"show"),s.triggerMethod.call(this,"show",t),this.currentView=t},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(t){return s.$(t)},open:function(t){this.$el.empty().append(t.el)},close:function(){var t=this.currentView;t&&!t.isClosed&&(t.close?t.close():t.remove&&t.remove(),s.triggerMethod.call(this,"close"),delete this.currentView)},attachView:function(t){this.currentView=t},reset:function(){this.close(),delete this.$el}}),s.Region.extend=s.extend,s.RegionManager=function(t){var e=t.Controller.extend({constructor:function(e){this._regions={},t.Controller.prototype.constructor.call(this,e)},addRegions:function(t,e){var n={};return i.each(t,function(t,r){"string"==typeof t&&(t={selector:t}),t.selector&&(t=i.defaults({},t,e));var s=this.addRegion(r,t);n[r]=s},this),n},addRegion:function(e,n){var r,s=i.isObject(n),o=i.isString(n),a=!!n.selector;return r=o||s&&a?t.Region.buildRegion(n,t.Region):i.isFunction(n)?t.Region.buildRegion(n,t.Region):n,this._store(e,r),this.triggerMethod("region:add",e,r),r},get:function(t){return this._regions[t]},removeRegion:function(t){var e=this._regions[t];this._remove(t,e)},removeRegions:function(){i.each(this._regions,function(t,e){this._remove(e,t)},this)},closeRegions:function(){i.each(this._regions,function(t){t.close()},this)},close:function(){this.removeRegions();var e=Array.prototype.slice.call(arguments);t.Controller.prototype.close.apply(this,e)},_store:function(t,e){this._regions[t]=e,this.length=i.size(this._regions)},_remove:function(t,e){e.close(),delete this._regions[t],this.triggerMethod("region:remove",t,e)}});return i.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(t){e.prototype[t]=function(){var e=[i.values(this._regions)].concat(i.toArray(arguments));return i[t].apply(i,e)}}),e}(s),s.TemplateCache=function(t){this.templateId=t},i.extend(s.TemplateCache,{templateCaches:{},get:function(t){var e=this.templateCaches[t];return e||(e=new s.TemplateCache(t),this.templateCaches[t]=e),e.load()},clear:function(){var t,e=n(arguments),i=e.length;if(i>0)for(t=0;i>t;t++)delete this.templateCaches[e[t]];else this.templateCaches={}}}),i.extend(s.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(t),this.compiledTemplate},loadTemplate:function(t){var e=s.$(t).html();return e&&0!==e.length||r("Could not find template: '"+t+"'","NoTemplateError"),e},compileTemplate:function(t){return i.template(t)}}),s.Renderer={render:function(t,e){return("function"==typeof t?t:s.TemplateCache.get(t))(e)}},s.View=e.View.extend({constructor:function(){i.bindAll(this,"render");var t=Array.prototype.slice.apply(arguments);e.View.prototype.constructor.apply(this,t),s.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:s.triggerMethod,getTemplate:function(){return s.getOption(this,"template")},mixinTemplateHelpers:function(t){t=t||{};var e=this.templateHelpers;return i.isFunction(e)&&(e=e.call(this)),i.extend(t,e)},configureTriggers:function(){if(this.triggers){var t={},e=i.result(this,"triggers");return i.each(e,function(e,i){t[i]=function(t){t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation();var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(e,i)}},this),t}},delegateEvents:function(t){this._delegateDOMEvents(t),s.bindEntityEvents(this,this.model,s.getOption(this,"modelEvents")),s.bindEntityEvents(this,this.collection,s.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(t){t=t||this.events,i.isFunction(t)&&(t=t.call(this));var n={},r=this.configureTriggers();i.extend(n,t,r),e.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){var t=Array.prototype.slice.call(arguments);e.View.prototype.undelegateEvents.apply(this,t),s.unbindEntityEvents(this,this.model,s.getOption(this,"modelEvents")),s.unbindEntityEvents(this,this.collection,s.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){this.isClosed||!1!==this.triggerMethod("before:close")&&(this.isClosed=!0,this.triggerMethod("close"),this.unbindUIElements(),this.remove())},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var t=i.result(this,"_uiBindings");this.ui={},i.each(i.keys(t),function(e){var i=t[e];this.ui[e]=this.$(i)},this)}},unbindUIElements:function(){this.ui&&(i.each(this.ui,function(t,e){delete this.ui[e]},this),this.ui=this._uiBindings,delete this._uiBindings)}}),s.ItemView=s.View.extend({constructor:function(){s.View.prototype.constructor.apply(this,n(arguments))},serializeData:function(){var t={};return this.model?t=this.model.toJSON():this.collection&&(t={items:this.collection.toJSON()}),t},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var t=this.serializeData();t=this.mixinTemplateHelpers(t);var e=this.getTemplate(),i=s.Renderer.render(e,t);return this.$el.html(i),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){this.isClosed||(this.triggerMethod("item:before:close"),s.View.prototype.close.apply(this,n(arguments)),this.triggerMethod("item:closed"))}}),s.CollectionView=s.View.extend({itemViewEventPrefix:"itemview",constructor:function(){this._initChildViewStorage(),s.View.prototype.constructor.apply(this,n(arguments)),this._initialEvents()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},addChildView:function(t){this.closeEmptyView();var e=this.getItemView(t),i=this.collection.indexOf(t);this.addItemView(t,e,i)},onShowCalled:function(){this.children.each(function(t){s.triggerMethod.call(t,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView()},showCollection:function(){var t;this.collection.each(function(e,i){t=this.getItemView(e),this.addItemView(e,t,i)},this)},showEmptyView:function(){var t=s.getOption(this,"emptyView");if(t&&!this._showingEmptyView){this._showingEmptyView=!0;var i=new e.Model;this.addItemView(i,t,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getItemView:function(){var t=s.getOption(this,"itemView");return t||r("An `itemView` must be specified","NoItemViewError"),t},addItemView:function(t,e,n){var r=s.getOption(this,"itemViewOptions");i.isFunction(r)&&(r=r.call(this,t,n));var o=this.buildItemView(t,e,r);this.addChildViewEventForwarding(o),this.triggerMethod("before:item:added",o),this.children.add(o),this.renderItemView(o,n),this._isShown&&s.triggerMethod.call(o,"show"),this.triggerMethod("after:item:added",o)},addChildViewEventForwarding:function(t){var e=s.getOption(this,"itemViewEventPrefix");this.listenTo(t,"all",function(){var i=n(arguments);i[0]=e+":"+i[0],i.splice(1,0,t),s.triggerMethod.apply(this,i)},this)},renderItemView:function(t,e){t.render(),this.appendHtml(this,t,e)},buildItemView:function(t,e,n){return new e(i.extend({model:t},n))},removeItemView:function(t){var e=this.children.findByModel(t);this.removeChildView(e),this.checkEmpty()},removeChildView:function(t){t&&(this.stopListening(t),t.close?t.close():t.remove&&t.remove(),this.children.remove(t)),this.triggerMethod("item:removed",t)},checkEmpty:function(){this.collection&&0!==this.collection.length||this.showEmptyView()},appendHtml:function(t,e){t.$el.append(e.el)},_initChildViewStorage:function(){this.children=new e.ChildViewContainer},close:function(){this.isClosed||(this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),s.View.prototype.close.apply(this,n(arguments)))},closeChildren:function(){this.children.each(function(t){this.removeChildView(t)},this),this.checkEmpty()}}),s.CompositeView=s.CollectionView.extend({constructor:function(){s.CollectionView.apply(this,n(arguments)),this.itemView=this.getItemView()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this._renderChildren,this))},getItemView:function(){var t=s.getOption(this,"itemView")||this.constructor;return t||r("An `itemView` must be specified","NoItemViewError"),t},serializeData:function(){var t={};return this.model&&(t=this.model.toJSON()),t},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var t=this.renderModel();return this.$el.html(t),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(s.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var t={};t=this.serializeData(),t=this.mixinTemplateHelpers(t);var e=this.getTemplate();return s.Renderer.render(e,t)},appendHtml:function(t,e){this.getItemViewContainer(t).append(e.el)},getItemViewContainer:function(t){if("$itemViewContainer"in t)return t.$itemViewContainer;var e;if(t.itemViewContainer){var n=i.result(t,"itemViewContainer");(e=t.$(n)).length<=0&&r("The specified `itemViewContainer` was not found: "+t.itemViewContainer,"ItemViewContainerMissingError")}else e=t.$el;return t.$itemViewContainer=e,e},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),s.Layout=s.ItemView.extend({regionType:s.Region,constructor:function(t){t=t||{},this._firstRender=!0,this._initializeRegions(t),s.ItemView.call(this,t)},render:function(){this._firstRender?this._firstRender=!1:this.isClosed?this._initializeRegions():this._reInitializeRegions();var t=Array.prototype.slice.apply(arguments);return s.ItemView.prototype.render.apply(this,t)},close:function(){if(!this.isClosed){this.regionManager.close();var t=Array.prototype.slice.apply(arguments);s.ItemView.prototype.close.apply(this,t)}},addRegion:function(t,e){var i={};return i[t]=e,this.addRegions(i)[t]},addRegions:function(t){return this.regions=i.extend(this.regions||{},t),this._buildRegions(t)},removeRegion:function(t){return this.regionManager.removeRegion(t)},_buildRegions:function(t){var e=this,i={parentEl:function(){return e.$el}};return this.regionManager.addRegions(t,i)},_initializeRegions:function(t){var e;this._initRegionManager(),e=i.isFunction(this.regions)?this.regions(t):this.regions||{},this.addRegions(e)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(t){t.reset()})},_initRegionManager:function(){this.regionManager=new s.RegionManager,this.listenTo(this.regionManager,"region:add",function(t,e){this[t]=e,this.trigger("region:add",t,e)}),this.listenTo(this.regionManager,"region:remove",function(t,e){delete this[t],this.trigger("region:remove",t,e)})}}),s.AppRouter=e.Router.extend({constructor:function(t){if(e.Router.prototype.constructor.apply(this,n(arguments)),this.options=t,this.appRoutes){var i=s.getOption(this,"controller");this.processAppRoutes(i,this.appRoutes)}},processAppRoutes:function(t,e){var n=i.keys(e).reverse();i.each(n,function(n){var r=e[n],s=t[r];if(!s)throw new Error("Method '"+r+"' was not found on the controller");this.route(n,r,i.bind(s,t))},this)}}),s.Application=function(t){this._initRegionManager(),this._initCallbacks=new s.Callbacks,this.vent=new e.Wreqr.EventAggregator,this.commands=new e.Wreqr.Commands,this.reqres=new e.Wreqr.RequestResponse,this.submodules={},i.extend(this,t),this.triggerMethod=s.triggerMethod},i.extend(s.Application.prototype,e.Events,{execute:function(){var t=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,t)},request:function(){var t=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,t)},addInitializer:function(t){this._initCallbacks.add(t)},start:function(t){this.triggerMethod("initialize:before",t),this._initCallbacks.run(t,this),this.triggerMethod("initialize:after",t),this.triggerMethod("start",t)},addRegions:function(t){return this._regionManager.addRegions(t)},removeRegion:function(t){this._regionManager.removeRegion(t)},module:function(){var t=n(arguments);return t.unshift(this),s.Module.create.apply(s.Module,t)},_initRegionManager:function(){this._regionManager=new s.RegionManager,this.listenTo(this._regionManager,"region:add",function(t,e){this[t]=e}),this.listenTo(this._regionManager,"region:remove",function(t){delete this[t]})}}),s.Application.extend=s.extend,s.Module=function(t,e){this.moduleName=t,this.submodules={},this._setupInitializersAndFinalizers(),this.app=e,this.startWithParent=!0,this.triggerMethod=s.triggerMethod},i.extend(s.Module.prototype,e.Events,{addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(t){this._isInitialized||(i.each(this.submodules,function(e){e.startWithParent&&e.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,s.triggerMethod.call(this,"before:stop"),i.each(this.submodules,function(t){t.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),s.triggerMethod.call(this,"stop"))},addDefinition:function(t,e){this._runModuleDefinition(t,e)},_runModuleDefinition:function(t,n){if(t){var r=i.flatten([this,this.app,e,s,s.$,i,n]);t.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new s.Callbacks,this._finalizerCallbacks=new s.Callbacks}}),i.extend(s.Module,{create:function(t,e,r){var s=t,o=n(arguments);o.splice(0,3);var a=(e=e.split(".")).length,l=[];return l[a-1]=r,i.each(e,function(e,i){var n=s;s=this._getModule(n,e,t),this._addModuleDefinition(n,s,l[i],o)},this),s},_getModule:function(t,e,i){var n=t[e];return n||(n=new s.Module(e,i),t[e]=n,t.submodules[e]=n),n},_addModuleDefinition:function(t,e,n,r){var s,o;i.isFunction(n)?(s=n,o=!0):i.isObject(n)?(s=n.define,o=n.startWithParent):o=!0,s&&e.addDefinition(s,r),e.startWithParent=e.startWithParent&&o,e.startWithParent&&!e.startWithParentIsConfigured&&(e.startWithParentIsConfigured=!0,t.addInitializer(function(t){e.startWithParent&&e.start(t)}))}}),s}(0,Backbone,_);Backbone.Paginator=function(t,e,i){"use strict";var n={version:"0.7.0"};return n.clientPager=t.Collection.extend({useDiacriticsPlugin:!0,useLevenshteinPlugin:!0,sortColumn:"",sortDirection:"desc",lastSortColumn:"",fieldFilterRules:[],lastFieldFilterRules:[],filterFields:"",filterExpression:"",lastFilterExpression:"",defaults_ui:{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4},initialize:function(){this.on("add",this.addModel,this),this.on("remove",this.removeModel,this),this.setDefaults()},setDefaults:function(){var t=e.defaults(this.paginator_ui,this.defaults_ui);e.defaults(this,t)},addModel:function(t){this.origModels.push(t)},removeModel:function(t){var i=e.indexOf(this.origModels,t);this.origModels.splice(i,1)},sync:function(n,r,s){var o=this;this.setDefaults();var a={};e.each(e.result(o,"server_api"),function(t,i){e.isFunction(t)&&(t=(t=e.bind(t,o))()),a[i]=t});var l=e.clone(o.paginator_core);e.each(l,function(t,i){e.isFunction(t)&&(t=(t=e.bind(t,o))()),l[i]=t}),l=e.defaults(l,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),l=e.extend(l,{data:decodeURIComponent(i.param(a)),processData:!1,url:e.result(l,"url")},s);var u=t.VERSION.split("."),c=!(0===parseInt(u[0],10)&&9===parseInt(u[1],10)&&10===parseInt(u[2],10)),h=l.success;l.success=function(t,e,i){h&&(c?h(t,e,i):h(r,t,l)),r&&r.trigger&&r.trigger("sync",r,t,l)};var d=l.error;l.error=function(t){d&&d(r,t,l),r&&r.trigger&&r.trigger("error",r,t,l)};var f=l.xhr=i.ajax(l);return r&&r.trigger&&r.trigger("request",r,f,l),f},nextPage:function(t){this.currentPage<this.information.totalPages&&(this.currentPage=++this.currentPage,this.pager(t))},previousPage:function(t){this.currentPage>1&&(this.currentPage=--this.currentPage,this.pager(t))},goTo:function(t,e){void 0!==t&&(this.currentPage=parseInt(t,10),this.pager(e))},howManyPer:function(t){if(void 0!==t){var e=this.perPage;this.perPage=parseInt(t,10),this.currentPage=Math.ceil((e*(this.currentPage-1)+1)/t),this.pager()}},setSort:function(t,e){void 0!==t&&void 0!==e&&(this.lastSortColumn=this.sortColumn,this.sortColumn=t,this.sortDirection=e,this.pager(),this.info())},setFieldFilter:function(t){e.isEmpty(t)?(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules="",this.pager(),this.info()):(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules=t,this.pager(),this.info())},doFakeFieldFilter:function(t){if(!e.isEmpty(t)){var i=this.origModels;return void 0===i&&(i=this.models),i=this._fieldFilter(i,t),""!==this.filterExpression&&(i=this._filter(i,this.filterFields,this.filterExpression)),i.length}},setFilter:function(t,e){void 0!==t&&void 0!==e&&(this.filterFields=t,this.lastFilterExpression=this.filterExpression,this.filterExpression=e,this.pager(),this.info())},doFakeFilter:function(t,i){if(void 0!==t&&void 0!==i){var n=this.origModels;return void 0===n&&(n=this.models),e.isEmpty(this.fieldFilterRules)||(n=this._fieldFilter(n,this.fieldFilterRules)),(n=this._filter(n,t,i)).length}},pager:function(t){var i=this,n=this.perPage,r=(i.currentPage-1)*n,s=r+n;void 0===i.origModels&&(i.origModels=i.models),i.models=i.origModels.slice(),""!==this.sortColumn&&(i.models=i._sort(i.models,this.sortColumn,this.sortDirection)),e.isEmpty(this.fieldFilterRules)||(i.models=i._fieldFilter(i.models,this.fieldFilterRules)),""!==this.filterExpression&&(i.models=i._filter(i.models,this.filterFields,this.filterExpression)),this.lastSortColumn===this.sortColumn&&this.lastFilterExpression===this.filterExpression&&e.isEqual(this.fieldFilterRules,this.lastFieldFilterRules)||(s=(r=0)+n,i.currentPage=1,this.lastSortColumn=this.sortColumn,this.lastFieldFilterRules=this.fieldFilterRules,this.lastFilterExpression=this.filterExpression),i.sortedAndFilteredModels=i.models.slice(),i.info(),i.reset(i.models.slice(r,s)),e.result(t,"success")},_sort:function(t,i,n){return t.sort(function(t,r){var s=t.get(i),o=r.get(i);if(e.isUndefined(s)||e.isUndefined(o)||null===s||null===o)return 0;if(s=s.toString().toLowerCase(),o=o.toString().toLowerCase(),"desc"===n)if(!s.match(/[^\-\d\.]/)&&s.match(/-?[\d\.]+/)&&!o.match(/[^\-\d\.]/)&&o.match(/-?[\d\.]+/)){if(o-0>s-0)return 1;if(s-0>o-0)return-1}else{if(o>s)return 1;if(s>o)return-1}else if(!s.match(/[^\-\d\.]/)&&s.match(/-?[\d\.]+/)&&!o.match(/[^\-\d\.]/)&&o.match(/-?[\d\.]+/)){if(o-0>s-0)return-1;if(s-0>o-0)return 1}else{if(o>s)return-1;if(s>o)return 1}if(t.cid&&r.cid){var a=t.cid,l=r.cid;if(l>a)return-1;if(a>l)return 1}return 0})},_fieldFilter:function(t,i){if(e.isEmpty(i))return t;var n=[];return e.each(t,function(t){var r=!0;e.each(i,function(i){if(!r)return!1;(r=!1,"function"===i.type)?e.wrap(i.value,function(e){return e(t.get(i.field))})()&&(r=!0):"required"===i.type?e.isEmpty(t.get(i.field).toString())||(r=!0):"min"===i.type?!e.isNaN(Number(t.get(i.field)))&&!e.isNaN(Number(i.value))&&Number(t.get(i.field))>=Number(i.value)&&(r=!0):"max"===i.type?!e.isNaN(Number(t.get(i.field)))&&!e.isNaN(Number(i.value))&&Number(t.get(i.field))<=Number(i.value)&&(r=!0):"range"===i.type?!e.isNaN(Number(t.get(i.field)))&&e.isObject(i.value)&&!e.isNaN(Number(i.value.min))&&!e.isNaN(Number(i.value.max))&&Number(t.get(i.field))>=Number(i.value.min)&&Number(t.get(i.field))<=Number(i.value.max)&&(r=!0):"minLength"===i.type?t.get(i.field).toString().length>=i.value&&(r=!0):"maxLength"===i.type?t.get(i.field).toString().length<=i.value&&(r=!0):"rangeLength"===i.type?e.isObject(i.value)&&!e.isNaN(Number(i.value.min))&&!e.isNaN(Number(i.value.max))&&t.get(i.field).toString().length>=i.value.min&&t.get(i.field).toString().length<=i.value.max&&(r=!0):"oneOf"===i.type?e.isArray(i.value)&&e.include(i.value,t.get(i.field))&&(r=!0):"equalTo"===i.type?i.value===t.get(i.field)&&(r=!0):"containsAllOf"===i.type?e.isArray(i.value)&&e.isArray(t.get(i.field))&&e.intersection(i.value,t.get(i.field)).length===i.value.length&&(r=!0):"pattern"===i.type?t.get(i.field).toString().match(i.value)&&(r=!0):r=!1}),r&&n.push(t)}),n},_filter:function(i,n,r){var s=this,o={};if(e.isString(n)?o[n]={cmp_method:"regexp"}:e.isArray(n)?e.each(n,function(t){o[t]={cmp_method:"regexp"}}):e.each(n,function(t,i){o[i]=e.defaults(t,{cmp_method:"regexp"})}),n=o,e.has(t.Paginator,"removeDiacritics")&&s.useDiacriticsPlugin&&(r=t.Paginator.removeDiacritics(r)),""===r||!e.isString(r))return i;var a=e.map(r.match(/\w+/gi),function(t){return t.toLowerCase()}),l="("+e.uniq(a).join("|")+")",u=new RegExp(l,"igm"),c=[];return e.each(i,function(i){var o=[];e.each(n,function(n,l){var c=i.get(l);if(c){var h=[];if(c=e.has(t.Paginator,"removeDiacritics")&&s.useDiacriticsPlugin?t.Paginator.removeDiacritics(c.toString()):c.toString(),"levenshtein"===n.cmp_method&&e.has(t.Paginator,"levenshtein")&&s.useLevenshteinPlugin){var d=t.Paginator.levenshtein(c,r);e.defaults(n,{max_distance:0}),d<=n.max_distance&&(h=e.uniq(a))}else h=c.match(u);h=e.map(h,function(t){return t.toString().toLowerCase()}),e.each(h,function(t){o.push(t)})}}),o=e.uniq(e.without(o,"")),e.isEmpty(e.difference(a,o))&&c.push(i)}),c},info:function(){var t=this,e={},i=t.sortedAndFilteredModels?t.sortedAndFilteredModels.length:t.length,n=Math.ceil(i/t.perPage);return e={totalUnfilteredRecords:t.origModels.length,totalRecords:i,currentPage:t.currentPage,perPage:this.perPage,totalPages:n,lastPage:n,previous:!1,next:!1,startRecord:0===i?0:(t.currentPage-1)*this.perPage+1,endRecord:Math.min(i,t.currentPage*this.perPage)},t.currentPage>1&&(e.previous=t.currentPage-1),t.currentPage<e.totalPages&&(e.next=t.currentPage+1),e.pageSet=t.setPagination(e),t.information=e,e},setPagination:function(t){var e=[],i=0,n=0,r=2*this.pagesInRange,s=Math.ceil(t.totalRecords/t.perPage);if(s>1)if(1+r>=s)for(i=1,n=s;n>=i;i++)e.push(i);else if(t.currentPage<=this.pagesInRange+1)for(i=1,n=2+r;n>i;i++)e.push(i);else if(s-this.pagesInRange>t.currentPage&&t.currentPage>this.pagesInRange)for(i=t.currentPage-this.pagesInRange;i<=t.currentPage+this.pagesInRange;i++)e.push(i);else for(i=s-r;s>=i;i++)e.push(i);return e},bootstrap:function(t){return e.extend(this,t),this.goTo(1),this.info(),this}}),n.clientPager.prototype.prevPage=n.clientPager.prototype.previousPage,n.requestPager=t.Collection.extend({sync:function(n,r,s){var o=this;o.setDefaults();var a={};e.each(e.result(o,"server_api"),function(t,i){e.isFunction(t)&&(t=(t=e.bind(t,o))()),a[i]=t});var l=e.clone(o.paginator_core);e.each(l,function(t,i){e.isFunction(t)&&(t=(t=e.bind(t,o))()),l[i]=t}),l=e.defaults(l,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),s.data=s.data?decodeURIComponent(i.param(e.extend(a,s.data))):decodeURIComponent(i.param(a)),l=e.extend(l,{data:decodeURIComponent(i.param(a)),processData:!1,url:e.result(l,"url")},s);var u=t.VERSION.split("."),c=!(0===parseInt(u[0],10)&&9===parseInt(u[1],10)&&10===parseInt(u[2],10)),h=l.success;l.success=function(t,e,i){h&&(c?h(t,e,i):h(r,t,l)),r&&r.trigger&&r.trigger("sync",r,t,l)};var d=l.error;l.error=function(t){d&&d(r,t,l),r&&r.trigger&&r.trigger("error",r,t,l)};var f=l.xhr=i.ajax(l);return r&&r.trigger&&r.trigger("request",r,f,l),f},setDefaults:function(){var t=this;e.defaults(t.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4}),e.each(t.paginator_ui,function(i,n){e.isUndefined(t[n])&&(t[n]=t.paginator_ui[n])})},requestNextPage:function(t){if(void 0!==this.currentPage)return this.currentPage+=1,this.pager(t);var e=new i.Deferred;return e.reject(),e.promise()},requestPreviousPage:function(t){if(void 0!==this.currentPage)return this.currentPage-=1,this.pager(t);var e=new i.Deferred;return e.reject(),e.promise()},updateOrder:function(t){void 0!==t&&(this.sortField=t,this.pager())},goTo:function(t,e){if(void 0!==t)return this.currentPage=parseInt(t,10),this.pager(e);var n=new i.Deferred;return n.reject(),n.promise()},howManyPer:function(t){void 0!==t&&(this.currentPage=this.firstPage,this.perPage=t,this.pager())},info:function(){var t={totalRecords:this.totalRecords||0,currentPage:this.currentPage,firstPage:this.firstPage,totalPages:Math.ceil(this.totalRecords/this.perPage),lastPage:this.totalPages,perPage:this.perPage,previous:!1,next:!1};return this.currentPage>1&&(t.previous=this.currentPage-1),this.currentPage<t.totalPages&&(t.next=this.currentPage+1),t.hasNext=t.next,t.hasPrevious=t.next,t.pageSet=this.setPagination(t),this.information=t,t},setPagination:function(t){var e=[],i=0,n=0,r=2*this.pagesInRange,s=Math.ceil(t.totalRecords/t.perPage);if(s>1)if(1+r>=s)for(i=1,n=s;n>=i;i++)e.push(i);else if(t.currentPage<=this.pagesInRange+1)for(i=1,n=2+r;n>i;i++)e.push(i);else if(s-this.pagesInRange>t.currentPage&&t.currentPage>this.pagesInRange)for(i=t.currentPage-this.pagesInRange;i<=t.currentPage+this.pagesInRange;i++)e.push(i);else for(i=s-r;s>=i;i++)e.push(i);return e},pager:function(t){return e.isObject(t)||(t={}),this.fetch(t)},url:function(){return void 0!==this.paginator_core&&void 0!==this.paginator_core.url?this.paginator_core.url:null},bootstrap:function(t){return e.extend(this,t),this.setDefaults(),this.info(),this}}),n.requestPager.prototype.nextPage=n.requestPager.prototype.requestNextPage,n.requestPager.prototype.prevPage=n.requestPager.prototype.requestPreviousPage,n}(Backbone,_,jQuery);