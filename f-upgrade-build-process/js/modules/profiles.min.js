CITY.profiles=function(){var a,e,s,i,l=$("#content"),t=$(".subfamily-choice"),r=$("#fb-profiles-wrapper #results-wrapper ol"),n=$("#fb-profiles-wrapper").attr("data-family"),p=function(l){r.addClass("js-load-hide").append($('<i class="fa fa-refresh fa-spin loading-fa-icon"></i>')),e=$.param.fragment(),s=$.deparam(e),""===e&&void 0===l?r.hide().fadeIn(800).removeClass("js-load-hide").children(".loading-fa-icon").remove():$.ajax({url:"/fb/search.html?"+e+"&collection=profiles&form=profiles&meta_B_orsand="+n+"&simpleResults=true&sort=metaK&bustCache="+Math.random(),success:function(e){r.empty().append(e).hide().fadeIn(800).removeClass("js-load-hide"),a.find("li").remove(),$.each(s,function(e,s){"meta_C_orsand"===e?(i=s.replace("[","").replace(/"/g,"").replace("]","").split(","),$.each(i,function(a,e){t.find('li a[class="'+e.replace(/ /g,"-")+'"]').addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden">remove filter</span></span>'),r.find(".subfamily a[data-filter=\"meta_C_orsand=['"+e+"']\"]").addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden" remove filter</span></span>')})):(a.append("<li data-filter="+e+'><a href="#">'+s.replace(/"/g,"")+'<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden">remove filter</span></span></a></li>'),r.find('.tag-list a[data-filter="'+e+"="+s+'"]').addClass("active").append('<span class="remove-filter"><i class="fa fa-times"></i><span class="visuallyhidden" remove filter</span></span>'))})}})};$("#results-wrapper").before('<ul class="display-filters"></ul>'),a=$(".display-filters"),l.on("click",".tag-list a, .subfamily-choice a",function(a){var e,s,i,l=$(this),r=$.deparam.fragment(),n=[];l.parents("ul:eq(0)").hasClass("tag-list")?((s=l.attr("data-filter")).split("=")[0],s.split("=")[1],l.hasClass("active")?(l.parent("li").hasClass("subfamily")?(i=l.attr("data-family-filter"),(n=r.meta_C_orsand.replace("[","").replace("]","").split(",")).splice($.inArray('"'+i+'"',n),1).join(","),e="meta_C_orsand=["+n+"]",$.bbq.pushState(e),t.find("a."+i).removeClass("active").find(".remove-filter").remove()):$.bbq.removeState(s.split("=")[0]),l.removeClass("active").find(".remove-filter").remove()):$.bbq.pushState(s)):(i=l.attr("data-family-filter"),l.hasClass("active")?((n=r.meta_C_orsand.replace("[","").replace("]","").split(",")).splice($.inArray('"'+i+'"',n),1).join(","),l.removeClass("active").find(".remove-filter").remove(),e=0===n.length?"meta_C_orsand=":"meta_C_orsand=["+n+"]"):(void 0===r.meta_C_orsand||""===r.meta_C_orsand.replace("[","").replace("]","").split(",")[0]?n='"'+i+'"':((n=r.meta_C_orsand.replace("[","").replace("]","").split(",")).push('"'+i+'"'),n.join(",")),e="meta_C_orsand=["+n+"]"),$.bbq.pushState(e)),a.preventDefault()}),p(),l.on("click",".display-filters a",function(a){$.bbq.removeState($(this).parent("li").attr("data-filter").split("=")[0]),a.preventDefault()}),$(window).on("hashchange",function(a){p(a)})}(CITY.debug);