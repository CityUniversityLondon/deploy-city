CITY.widgets=function(e){"use strict";var t=CITY.debug,n=CITY.createGallery,i=(CITY.downloadFileTypes,CITY.viewportChanged,function(e,t,n){var i=e.find(".bx-prev"),o=e.find(".bx-next"),a=n||"All";i.empty().append('<i class=" fa fa-caret-left"></i>'),o.empty().append('<i class=" fa fa-caret-right"></i>'),t&&i.after('<a href="'+t+'" class="bx-all" >'+a+"</a>"),e.find(".bx-controls-direction").appendTo(e),e.children("h2").addClass("controls-direction"),e.find(".widget-content").addClass("scrollable"),e.removeClass("widget-loading").children(".loading-fa-icon").remove()}),o=function(){var e=$("#news-widget"),t=e.find("#news-results");$("#news-results > .article").size()>3?(t.wrapChildren({childElem:".article",sets:3}),t.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(e,"//www.city.ac.uk/news")}})):e.removeClass("widget-loading").children(".loading-fa-icon").remove()},a=function(){var e=$("#events-widget"),t=$("#events-results");$(".vevent",t).click(function(){return window.location=$(this).find("a").attr("href"),!1}),$("#events-results > .vevent").size()>3?(t.wrapChildren({childElem:".event",sets:3}),t.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(e,"//www.city.ac.uk/events")}})):e.removeClass("widget-loading").children(".loading-fa-icon").remove()},d=function(){var e,n=$("#flickr-widget"),o=n.find("ul");n.mouseenter(function(){e||(e=!0,$("a .imageurl",n).each(function(){var e=$(this),t='<img src="'+e.text()+'" alt="">';e.parent().text("").prepend(t)}),$("p .imageurl",n).each(function(){var e=$(this),t="background-image: url("+e.text()+");";e.parent().attr("style",t),e.remove()}))}),o.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,minSlides:1,maxSlides:4,slideWidth:330,slideMargin:0,onSliderLoad:function(){t("flickr callback..."),$(".widget-content",n).each(function(){var e=$("ul div:first-child",this),t=$(this),i=e.height(),o=e.width();t.addClass("scrollable"),t.stop().animate({"min-height":i}),t.css("width",o),n.removeClass("widget-loading").children(".loading-fa-icon").remove()}),i(n)}})},r=function(){var e=$("#courses-widget");e.find(".widget-content").accordion({heightStyle:"content",collapsible:!0,active:!1,animate:!1,icons:{header:"ui-icon-triangle-1-s",headerSelected:"ui-icon-triangle-1-n"},create:function(){i(e)}})},l=function(){var e,n=$("#testimonials-widget"),o=n.find(".widget-content").find("ul");if($("li",o).length<2)return t("Less than 2 testimonials, no need for carousel"),void n.removeClass("widget-loading").addClass("widget-one-item").children(".loading-fa-icon").remove();e=function(){i(n),n.removeClass("widget-loading").children(".loading-fa-icon").remove()},o.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){e()}})},s=function(){var e,n=$("#profiles-widget"),o=n.find(".widget-content").find("ul");if($("li",o).length<2)return t("Less than 2 testimonials, no need for carousel"),void n.removeClass("widget-loading").children(".loading-fa-icon").remove();e=function(){i(n),n.removeClass("widget-loading").children(".loading-fa-icon").remove()},o.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){e()}})},c=function(){var e,n=$("#spotlight-research-widget"),o=n.find(".widget-content").find("ul");if($("li",o).length<2)return t("Less than 2 spotlight on research, no need for carousel"),void n.removeClass("widget-loading").addClass("widget-one-item").children(".loading-fa-icon").remove();e=function(){i(n),n.removeClass("widget-loading").children(".loading-fa-icon").remove()},o.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){e()}})},f=function(){var e=$("#rss-widget"),t=e.find(".widget-content").find(".items");t.children().length>1?t.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(e)}}):e.removeClass("widget-loading").children(".loading-fa-icon").remove()},u=function(){var e,t=$("#start_date").val(),n=$("#end_date").val(),i=new Date,o=new Date,a=function(e,t){var n=e.split("/"),i=n[2].split(" ");return t.setFullYear(i[0]),t.setMonth(n[1]-1),t.setDate(n[0]),t};i=a(t,i),(o=a(n,o))>=(e=new Date)&&i<=e?($("#content_on_date").attr("class","widget-content cta-widget-show"),$("#content_out_of_date").attr("class","cta-widget-hide")):($("#content_out_of_date").attr("class","widget-content cta-widget-show"),$("#content_on_date").attr("class","cta-widget-hide"))},g=function(){var e=$("#gallery-widget .gallery");return n(e,!0)},h=function(){$("div.free-text a").unbind("click").click(function(){})};!function(){var e,n={events:{f:a},news:{f:o},flickr:{f:d},courses:{f:r},testimonials:{f:l},rss:{f:f},gallery:{f:g},cta:{f:u},freetext:{f:h},profiles:{f:s},"spotlight-research":{f:c}};for(e in n)n.hasOwnProperty(e)&&(0===$("#"+e+"-widget").length?t("no "+e+" widget"):"function"!=typeof n[e].f?t("can't find init func of "+e+" widget"):(t("running init func of "+e+" widget"),n[e].f.apply()))}()}(window);