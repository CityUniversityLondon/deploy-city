CITY.visit=function(e,i){var t=new google.maps.LatLng(51.527761,-.103283),n=i("#map-container"),r={zoom:17,key:AIzaSyBvg6r1x2ZRKPAsceVaKPlg6tO20QiBDpo,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0},o=new google.maps.Map(document.getElementById("map-canvas"),r),a=i("#map-search"),s=new google.maps.InfoWindow({maxWidth:400}),l={bigMarkersArray:[],bigBuildingsArray:[],buildingsObj:{},buildings:{toggler:null,markersArray:[],zoomLevel:17,list:""},libraries:{toggler:i("#toggle-libraries"),markersArray:[],zoomLevel:17,list:""},accommodation:{toggler:null,markersArray:[],zoomLevel:17,list:""},lectureTheatres:{toggler:null,markersArray:[],zoomLevel:17,list:""},studentCentre:{toggler:i("#toggle-studentCentre"),markersArray:[],zoomLevel:17,list:""},sports:{toggler:null,markersArray:[],zoomLevel:17,list:""},computerLabs:{toggler:i("#toggle-computerLabs"),markersArray:[],zoomLevel:17,list:""}},g={cycleHire:{src:"http://webapps.city.ac.uk/matrix/maps/cycle-hire.php",toggler:i("#cycle-hire"),preserveViewport:!0},bikes:{src:"http://webapps.city.ac.uk/matrix/maps/cycle-parking.kml",toggler:i("#bikes"),preserveViewport:!0},atms:{src:"http://webapps.city.ac.uk/matrix/maps/atms.kml",toggler:i("#cash-points"),preserveViewport:!0}},c=function(e){var t,n=e.getState();i.each(n,function(e,n){"0"!==e?i.each(l.buildingsObj,function(i,n){e===i&&(t=n,function(e){var i;if(e)for(i in e)e.hasOwnProperty(i)&&"function"!=typeof e[i]&&e[i].setMap(null)}(l.bigMarkersArray),t.setVisible(!0),s.setContent(t.infoHtml),s.open(o,t),o.panTo(t.position),t.setMap(o))}):s.close()})},p=function(e){var t={};e&&("string"==typeof e?t[e]=1:e.hasOwnProperty("id")?t[e.id]=1:t[0]=1,i.bbq.pushState(t,2))},u=function(e,t){var n="";return e.children().each(function(){return this.nodeName!=t||(n=i(this).text(),!1)}),n},d=function(e,t,r){var g,d,m={},f=[],h={};i(e).find("item").each(function(){g=i(this),m.index=1,m.name=g.find("title").text(),m.linkHref=g.find("link").text(),m.description=g.find("description").text(),m.icon=u(g,"CUL:icon"),m.category=g.find("category").text(),m.id=g.find("guid").text(),m.buildingPrefix=u(g,"CUL:buildingPrefix").replace(/^\s+|\s+$/g,""),m.hexColour=u(g,"CUL:hexColour").replace(/^\s+|\s+$/g,""),m.geoLat=u(g,"geo:lat"),m.geoLong=u(g,"geo:long"),m.point=new google.maps.LatLng(parseFloat(m.geoLat),parseFloat(m.geoLong)),d=function(e){var t,n,r,o="#"+e.category,a="";return a=0!==e.linkHref.length?'<div id="info-window" style="min-height: 100px;"><h3><a href="'+e.linkHref+'">'+e.name+"</a></h3>":'<div id="info-window" style="min-height: 100px;"><h3>'+e.name+"</h3>",0!==e.buildingPrefix.length&&(a+='<p class="building-prefix"><strong>Rooms beginning: '+e.buildingPrefix+"</strong></p>",e.buildingPrefix="("+e.buildingPrefix+")"),a+=e.description+"</div>",(t=new google.maps.Marker({map:e.map,position:e.point,icon:e.icon,animation:google.maps.Animation.DROP})).set("id",e.id),t.set("infoHtml",a),google.maps.event.addListener(t,"click",function(e){return p(t)}),n=i("<li />",{id:"building-"+e.id,class:"building"}),r=i("<a />",{href:"#",html:"<span>"+e.name+" "+e.buildingPrefix+"</span>",click:function(e){return p(i(e.target).parents("li").attr("id").replace("building-","")),!1},css:{background:"transparent url("+e.icon+"?v=1123) no-repeat left center"}}),n.append(r).appendTo(o),t}(m),"buildings"!==m.category?l.bigMarkersArray.push(d):l.bigBuildingsArray.push(d),l.buildingsObj[d.id]=d,f.push(m.name),h[m.name]=m.id,l[m.category]?l[m.category].markersArray.push(d):l[m.category]=function(e){this.toggler=null,this.markersArray=[],this.zoomLevel=17}(m.category)}),a.autocomplete({source:f,select:function(e){setTimeout(function(){var e=a.val();a.blur(),e in h&&p(h[e])},0)}}).focusin(function(){a.attr("value","")}),i("#vs-button").click(function(){a.focus()}),google.maps.event.addListener(s,"closeclick",function(){p(s)}),function(e){var i;if(e)for(i in e)e.hasOwnProperty(i)&&"function"!=typeof e[i]&&e[i].setMap(o)}(l.bigBuildingsArray),n.removeClass("loading").children(".loading-fa-icon").remove(),i(window).bind("hashchange",c),i(window).trigger("hashchange")};return{init:function(){var e;n.addClass("loading").append(i('<i class="fa fa-refresh fa-spin loading-fa-icon"></i>')),e=g,i.each(e,function(){var e=this.toggler,i=new google.maps.KmlLayer(this.src,{preserveViewport:this.preserveViewport});e.click(function(t){return e.toggleClass("enabled"),i.setMap(e.hasClass("enabled")?o:null),!1})}),i.ajax({type:"GET",url:"https://www.city.ac.uk/visit/feeds/locations",dataType:"xml",success:d}),i("#filter").accordion({collapsible:!0,autoHeight:!1,clearStyle:!0,active:!1}),i("#journey-link").bind("click",function(e){e.preventDefault(),i("html, body").animate({scrollTop:i("#journey-planner").offset().top},1e3)})},cityLayers:l,infoWindow:s,map:o}}(CITY,jQuery),CITY.visit.init();