var startRank,Mustache=require("mustache"),defer=require("./utils/defer"),$moreButton=$(".load-more"),query=$moreButton.attr("data-query"),perPage=$moreButton.attr("data-per-page"),$userList=$(".directory-users"),ajaxUrl="//www.city.ac.uk/fb/search.html",$resultMsgDisplayed=$(".directory-results-msg__displayed"),ajaxCall=function(){startRank=$moreButton.attr("data-start-rank"),$.ajax({url:ajaxUrl,dataType:"json",data:{collection:"user-directory",form:"json",sort:"metaf",start_rank:startRank,num_ranks:perPage,query:"*"+query+"*"},success:function(e){templateData(e)}})},templateData=function(e){numberResults=e.total,resultsPerPage=e.resultsPerPage,numberResultsCut=numberResults<resultsPerPage?numberResults:resultsPerPage,currentEnd=e.currEnd,totalDisplay=currentEnd+resultsPerPage,renderHTML="",newPath="",0!==numberResults&&(renderHTML=Mustache.render('{{#users}}<li class="directory-user directory-user--loading" itemscope itemtype="http://schema.org/Person"><h4 class="directory-user__name" itemprop="name">{{{title}}} {{{firstName}}} {{{lastName}}}</h4><div class="row"><div class="col-xs-24 col-md-8">{{#job}}<span class="directory-user__info directory-user__info--job" itemprop="jobTitle">{{{job}}}</span>{{/job}}</div><div class="col-xs-24 col-md-8">{{#tel}}<span class="directory-user__info directory-user__info--tel" itemprop="telephone"><i class="fa fa-phone"></i><a href="tel:0044(0)207040{{tel}}">+44(0) 207 040 {{tel}}</a></span>{{/tel}}{{#email}}<span class="directory-user__info directory-user__info--email" itemprop="email"><i class="fa fa-envelope-o"></i><a href="mailto:{{{email}}}">{{{email}}}</a></span>{{/email}}</div><div class="col-xs-24 col-md-8">{{#room}}<span class="directory-user__info directory-user__info--room"><i class="fa fa-map-marker"></i>{{{room}}}</span>{{/room}}{{#dep}}<span class="directory-user__info directory-user__info--department"><i class="fa fa-building-o"></i>{{{dep}}}</span>{{/dep}}</div></div></li>{{/users}}',e)),appendData(renderHTML,currentEnd,numberResults)},appendData=function(e,r){$userList.children(".loading-fa-icon").remove(),$userList.append(e),$moreButton.attr("data-start-rank",parseInt(startRank)+10),$resultMsgDisplayed.html(r),r===numberResults&&$moreButton.remove()},init=function(){$moreButton.on("click",function(e){e.preventDefault(),$userList.append($('<i class="fa fa-refresh fa-spin loading-fa-icon"></i>')),ajaxCall()})};defer(init);