module.exports=function(){var e=require("./jquery"),i=require("../utils/debug"),r=require("./funcs/custom-ajax"),n=(require("./funcs/viewport-changed"),require("./funcs/create-gallery")),a=require("./funcs/create-slider"),t=require("./funcs/get-window-width"),s=require("./funcs/init-dropdowns"),o=require("./funcs/init-dynamic-map"),l=require("./funcs/az-listing"),c=require("./funcs/image-accordion"),d=require("./funcs/init-see-more"),u=require("./funcs/image-creditation"),p=require("./funcs/placeholder-fallback"),f=require("./funcs/init-image-carousel"),h=require("./funcs/init-white-cards"),y=require("./funcs/search-autocomplete"),m=require("./funcs/init-news-events-strip"),g=require("../utils/init-cookie-notice"),w=require("./funcs/header-primary-nav"),v=require("./funcs/header-navs"),b=require("./funcs/footer"),j=require("./funcs/popup-dialog"),q=require("../utils/scroll-to"),k=require("./funcs/responsive-tables"),C=require("./funcs/cyclic-popup"),_=function(x){"use strict";var P={googleMapsApi:{description:"google maps api",src:"https://maps.googleapis.com/maps/api/js?key=AIzaSyBvg6r1x2ZRKPAsceVaKPlg6tO20QiBDpo&sensor=false"},flowplayer:{description:"include flowplayer for pages with videos",src:"lib/flowplayer/flowplayer-3.2.4.min.js"},flowplayerEmbed:{description:"Embed code for flowplayer",src:"lib/flowplayer/flowplayer.embed-3.0.3.min.js"},swfobject:{description:"swfobject for youtube video(s)",src:"lib/swfobject/swfobject.js"},highcharts:{description:"JQuery charting plugin",src:"lib/jquery/plugins/highcharts/highcharts-4-1-4.js"},jVectorMap:{description:"jQuery plugin for SVG world map",src:"lib/jquery/plugins/vector-map/jquery.vector-map.min.js"},worldMap:{description:"map svg",src:"lib/jquery/plugins/vector-map/world-en.js"},buildingTheVision:{description:"building the vision specific scripts",src:"buildingTheVision.js"},library:{description:"library site scripts",src:"library.js"},location:{description:"Computer Room site scripts",src:"location.js"}},A="//"+document.location.hostname.replace(/www|intranet/,"s1").replace("cass.","").replace("citysport.org.uk","city.ac.uk")+"/cityr/js/",S=x.cityVersion||"123456789.",V=function(){var i=e("img.youtube"),r=e("img.fms");i.length&&function(i){i.each(function(i,r){var n=e(r),a=n.attr("id").replace("vid_","");n.replaceWith('<div class="embed-wrapper"><div class="embed-container"><iframe height=320 width= 500 src="//www.youtube.com/embed/'+a+"?rel=0&wmode=transparent\" frameborder='0' allowfullscreen></iframe></div></div>")})}(i),r.length&&yepnope({load:P.swfobject.src,callback:function(){!function(i){var r="//s1.city.ac.uk/i/flowplayer-cass.jpg?v=8105",n="//s1.city.ac.uk/i/flowplayer-city.jpg?v=8105";i.each(function(i,a){var t=e(a),s=687,o=419,l=t.attr("id"),c=l.replace("vid_",""),d=null,u=_.isCass?r:n;0!==t.parents(".course-description").length&&(s=419),t.hasClass("widescreen")?o=.61*s:(s=500,o=320),swfobject.hasFlashPlayerVersion("9.0.28")?(d="{'clip': {'provider': 'rtmp'}, 'playlist': [{'url':'"+u+"', 'autoPlay': true}, {'url': '"+c.replace("vid_","")+"/Hi_bandwidth', 'autoPlay': false, 'scaling': 'fit'}], 'plugins': {'rtmp': {'url': '//s1.city.ac.uk/js/flowplayer/flowplayer.rtmp-3.2.3.swf', 'netConnectionUrl': 'rtmp://media.city.ac.uk/flowplayer', 'objectEncoding': '0', 'proxyType': 'none' }, 'controls': {'url': 'flowplayer.controls.swf'} } }",swfobject.embedSWF("//s1.city.ac.uk/js/flowplayer/flowplayer-3.2.6.swf",l,s,o,"9.0.0","//s1.city.ac.uk/js/swfobject/expressInstall.swf",{config:d},{allowScriptAccess:"always",allowfullscreen:"true",wmode:"transparent"},!1,function(i){e(i.ref).wrap('<div class="embed-wrapper" style="width:'+s+'px"><div class="embed-container"></div></div>')})):t.after('<p class="notice-message"><i class="fa fa-exclamation-triangle" style="color : #CCCC00"></i> You need to have flash player 9.0.28 or greater installed to see the video.</p><p><a href="http://get.adobe.com/flashplayer/">Get Flash Player</a></p>')})}(r)}})},T=function(e){var i,r;return/^(https?:\/\/)?([^\/.]+\.)+[^\/]+\//.test(e.url)?e:((i=((/s1/.test(e.url)?"":A)+e.url).split("/"))[r=i.length-1]=S+i[r],e.url=i.join("/"),/s1\.city/.test(e.url)&&!/js\/lib/.test(e.url)&&(e.url=e.url.replace(/js$/,"min.js")),e)};return{init:function(){var r,t,_,x,P,A,S,z,I,M,O,W,F,E,Q,Y,B,G,H;i("CITY ready (we are in "+document.compatMode+")"),yepnope.addFilter(T),r=e("body"),t=r.find("#search, #header__search__form"),_=r.find(".search-form[data-autocomplete-status!='off']"),x=_.find(".search-form__query"),P=t.find("#query"),A=e("#fb-queryform"),S=e("#search-query",A),z="intranet"===r.attr("id")?"intranet":"main-all",I=e("#content").find(".gallery"),M=e(".az-single-page"),O=_.attr("data-collection"),W=e("#primary-nav"),F=e("#secondary-nav"),E=e("#secondary-nav > li"),Q=e("#promo-area"),Y=r.find(".accordion"),B=r.find(".responsive-tabs"),G=W.data("url")||"",H=G.indexOf("/my-country/")<0,Modernizr.svg||e("#header__logo img").attr("src",function(){return e(this).attr("src").replace(".svg",".png")}),w(),v(),b(),B.accordionTabs(),s(),l(M),c(),d(),h(),m(),a(Q),p(),f(),g(e),j(),k(),C(),u(),I.each(function(){n(e(this))}),G.indexOf("//www.city.ac.uk/news")>=0?F.hide():H&&(e("ol#secondary-nav > li:last > a").length&&e("ol#secondary-nav-siblings").length&&(-1===e("ol#secondary-nav-siblings a").map(function(){return this.href}).toArray().indexOf(e("ol#secondary-nav > li:last > a")[0].href)?e("ol#secondary-nav").append(e("<li>").html(e("ol#secondary-nav-siblings"))):e("ol#secondary-nav > li:last").empty().append(e("ol#secondary-nav-siblings"))),e("ol#primary-nav li, ol#secondary-nav li").removeClass("selected"),e('ol#primary-nav a[href="'+G+'"], ol#secondary-nav a[href="'+G+'"]').parent("li").addClass("selected"),0===W.find(".current").length&&0===F.find(".selected").length&&(F.hide(),W.addClass("top-level")),0===E.length?F.hide():(e("#secondary-nav-siblings").parent().prev("li").addClass("end"),F.find("> li.selected").prev().addClass("selected-join"),0!==F.find(".selected").length&&W.find(".current").addClass("parent"))),Y.accordion({heightStyle:"content",collapsible:!0,active:!1,animate:!1,icons:{header:"ui-icon-triangle-1-s",headerSelected:"ui-icon-triangle-1-n"},activate:function(e,i){q(i.newHeader)}}),y(t,P,z),y(A,S,z),y(_,x,O),e("iframe[src*='youtube']").each(function(){var i=e(this),r=i.outerWidth();i.parent().hasClass("embed-container")||i.wrap('<div class="embed-wrapper" style="width:'+r+'px"><div class="embed-container"></div></div>')}),o(e("#dynamic-gmap")),e(".unit-lists .unit-lists-title").click(function(){e(this).parents(".unit-lists").toggleClass("unit-lists-expanded")}),1!==e("#future-fund-forms").length&&1!==e("#racing-form").length||(e("#cff-regular-donation input[type=radio]").click(function(){var i=e(this).parent();e(".donate-appeal").show(),i.find(".donation-other-option").is(":checked")?i.find(".donation-other-amount").show().find("input").attr("name","regular_amount"):i.find(".donation-other-amount").hide().find("input").attr("name","").attr("value","")}),e("#cff-single-donation input[type=radio]").click(function(){var i=e(this).parent();i.find(".donation-other-option").is(":checked")?i.find(".donation-other-amount").show().find("input").attr("name","tfa_Amountyouwishtod"):i.find(".donation-other-amount").hide().find("input").attr("name","").attr("value","")})),e(".media-ribbon .embed-container").videoPreview({showInfo:0}),e(".widget-content .embed-container").videoPreview(),e(".international-london .embed-container").videoPreview(),e(".social-wall .embed-container").videoPreview(),e(".embed-container.embed-container--default-yt-preview").videoPreview(),0!==e("#library").length&&yepnope({load:"modules/library/library.js",callback:function(){i("loaded library datepicker")}}),e(function(){V()})},load:function(e,i){var r,n=/^https?:\/\//.test((r=P[e]).src)?r.src:A+(/plugins|lib/.test(r.src)?"":"modules/")+r.src;yepnope({load:n,callback:i})},debug:i,setVersion:function(e){S=e},searchAutoComplete:y,objectSize:function(e){var i,r=0;for(i in e)e.hasOwnProperty(i)&&(r+=1);return r},getWindowWidth:t,customAJAX:r,imageCreditation:u,s1Server:A}}(window);return window.CITY=_,_}();