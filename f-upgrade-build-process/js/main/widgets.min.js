module.exports=function(){"use strict";var e=require("./jquery"),t=require("../utils/debug"),n=require("./funcs/create-gallery"),i=(require("./funcs/download-file-types"),require("./funcs/viewport-changed"),function(e,t,n){var i=e.find(".bx-prev"),o=e.find(".bx-next"),a=n||"All";i.empty().append('<i class=" fa fa-caret-left"></i>'),o.empty().append('<i class=" fa fa-caret-right"></i>'),t&&i.after('<a href="'+t+'" class="bx-all" >'+a+"</a>"),e.find(".bx-controls-direction").appendTo(e),e.children("h2").addClass("controls-direction"),e.find(".widget-content").addClass("scrollable"),e.removeClass("widget-loading").children(".loading-fa-icon").remove()}),o=function(){var t=e("#news-widget"),n=t.find("#news-results");e("#news-results > .article").size()>3?(n.wrapChildren({childElem:".article",sets:3}),n.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(t,"//www.city.ac.uk/news")}})):t.removeClass("widget-loading").children(".loading-fa-icon").remove()},a=function(){var t=e("#events-widget"),n=e("#events-results");e(".vevent",n).click(function(){return window.location=e(this).find("a").attr("href"),!1}),e("#events-results > .vevent").size()>3?(n.wrapChildren({childElem:".event",sets:3}),n.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(t,"//www.city.ac.uk/events")}})):t.removeClass("widget-loading").children(".loading-fa-icon").remove()},r=function(){var n,o=e("#flickr-widget"),a=o.find("ul");o.mouseenter(function(){n||(n=!0,e("a .imageurl",o).each(function(){var t=e(this),n='<img src="'+t.text()+'" alt="">';t.parent().text("").prepend(n)}),e("p .imageurl",o).each(function(){var t=e(this),n="background-image: url("+t.text()+");";t.parent().attr("style",n),t.remove()}))}),a.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,minSlides:1,maxSlides:4,slideWidth:330,slideMargin:0,onSliderLoad:function(){t("flickr callback..."),e(".widget-content",o).each(function(){var t=e("ul div:first-child",this),n=e(this),i=t.height(),a=t.width();n.addClass("scrollable"),n.stop().animate({"min-height":i}),n.css("width",a),o.removeClass("widget-loading").children(".loading-fa-icon").remove()}),i(o)}})},d=function(){var t=e("#courses-widget");t.find(".widget-content").accordion({heightStyle:"content",collapsible:!0,active:!1,animate:!1,icons:{header:"ui-icon-triangle-1-s",headerSelected:"ui-icon-triangle-1-n"},create:function(){i(t)}})},l=function(){var n,o=e("#testimonials-widget"),a=o.find(".widget-content").find("ul");if(e("li",a).length<2)return t("Less than 2 testimonials, no need for carousel"),void o.removeClass("widget-loading").addClass("widget-one-item").children(".loading-fa-icon").remove();n=function(){i(o),o.removeClass("widget-loading").children(".loading-fa-icon").remove()},a.bxSlider({auto:!1,autoControls:!1,pause:15e3,slideMargin:10,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){n()}})},s=function(){var n,o=e("#profiles-widget"),a=o.find(".widget-content").find("ul");if(e("li",a).length<2)return t("Less than 2 testimonials, no need for carousel"),void o.removeClass("widget-loading").children(".loading-fa-icon").remove();n=function(){i(o),o.removeClass("widget-loading").children(".loading-fa-icon").remove()},a.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){n()}})},c=function(){var n,o=e("#spotlight-research-widget"),a=o.find(".widget-content").find("ul");if(e("li",a).length<2)return t("Less than 2 spotlight on research, no need for carousel"),void o.removeClass("widget-loading").addClass("widget-one-item").children(".loading-fa-icon").remove();n=function(){i(o),o.removeClass("widget-loading").children(".loading-fa-icon").remove()},a.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){n()}})},u=function(){var t=e("#rss-widget"),n=t.find(".widget-content").find(".items");n.children().length>1?n.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){i(t)}}):t.removeClass("widget-loading").children(".loading-fa-icon").remove()},f=function(){var t,n=e("#start_date").val(),i=e("#end_date").val(),o=new Date,a=new Date,r=function(e,t){var n=e.split("/"),i=n[2].split(" ");return t.setFullYear(i[0]),t.setMonth(n[1]-1),t.setDate(n[0]),t};o=r(n,o),(a=r(i,a))>=(t=new Date)&&o<=t?(e("#content_on_date").attr("class","widget-content cta-widget-show"),e("#content_out_of_date").attr("class","cta-widget-hide")):(e("#content_out_of_date").attr("class","widget-content cta-widget-show"),e("#content_on_date").attr("class","cta-widget-hide"))},g=function(){var t=e("#gallery-widget .gallery");return n(t,!0)},h=function(){e("div.free-text a").unbind("click").click(function(){})};return function(){var n,i={events:{f:a},news:{f:o},flickr:{f:r},courses:{f:d},testimonials:{f:l},rss:{f:u},gallery:{f:g},cta:{f:f},freetext:{f:h},profiles:{f:s},"spotlight-research":{f:c}};for(n in i)i.hasOwnProperty(n)&&(0===e("#"+n+"-widget").length?t("no "+n+" widget"):"function"!=typeof i[n].f?t("can't find init func of "+n+" widget"):(t("running init func of "+n+" widget"),i[n].f.apply()))}}();